<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mette Langaas">
<meta name="dcterms.date" content="2023-02-09">

<title>MA8701 Advanced methods in statistical inference and learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="L10_files/libs/clipboard/clipboard.min.js"></script>
<script src="L10_files/libs/quarto-html/quarto.js"></script>
<script src="L10_files/libs/quarto-html/popper.min.js"></script>
<script src="L10_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="L10_files/libs/quarto-html/anchor.min.js"></script>
<link href="L10_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L10_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="L10_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="L10_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="L10_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="L10_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="L10_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-we-begin" id="toc-before-we-begin" class="nav-link active" data-scroll-target="#before-we-begin">Before we begin</a>
  <ul class="collapse">
  <li><a href="#literature" id="toc-literature" class="nav-link" data-scroll-target="#literature">Literature</a></li>
  </ul></li>
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models">Generalized linear models</a>
  <ul class="collapse">
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">The model</a></li>
  <li><a href="#explaining-beta-in-logistic-regression" id="toc-explaining-beta-in-logistic-regression" class="nav-link" data-scroll-target="#explaining-beta-in-logistic-regression">Explaining <span class="math inline">\(\beta\)</span> in logistic regression</a></li>
  <li><a href="#parameter-estimation" id="toc-parameter-estimation" class="nav-link" data-scroll-target="#parameter-estimation">Parameter estimation</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic regression</a></li>
  <li><a href="#algorithms" id="toc-algorithms" class="nav-link" data-scroll-target="#algorithms">Algorithms</a></li>
  <li><a href="#properties" id="toc-properties" class="nav-link" data-scroll-target="#properties">Properties</a></li>
  <li><a href="#penalized-logistic-regression" id="toc-penalized-logistic-regression" class="nav-link" data-scroll-target="#penalized-logistic-regression">Penalized logistic regression</a></li>
  <li><a href="#algorithms-1" id="toc-algorithms-1" class="nav-link" data-scroll-target="#algorithms-1">Algorithms</a></li>
  <li><a href="#ridge-logistic-regression-irwls" id="toc-ridge-logistic-regression-irwls" class="nav-link" data-scroll-target="#ridge-logistic-regression-irwls">Ridge logistic regression IRWLS</a></li>
  <li><a href="#lasso-logistic-regression-fitting-algoritm" id="toc-lasso-logistic-regression-fitting-algoritm" class="nav-link" data-scroll-target="#lasso-logistic-regression-fitting-algoritm">Lasso logistic regression fitting algoritm</a></li>
  <li><a href="#criteria-for-choosing-lambda" id="toc-criteria-for-choosing-lambda" class="nav-link" data-scroll-target="#criteria-for-choosing-lambda">Criteria for choosing <span class="math inline">\(\lambda\)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#evaluation-metrics" id="toc-evaluation-metrics" class="nav-link" data-scroll-target="#evaluation-metrics">Evaluation metrics</a>
  <ul class="collapse">
  <li><a href="#confusion-matrix-sensitivity-specificity" id="toc-confusion-matrix-sensitivity-specificity" class="nav-link" data-scroll-target="#confusion-matrix-sensitivity-specificity">Confusion matrix, sensitivity, specificity</a></li>
  <li><a href="#roc-curves" id="toc-roc-curves" class="nav-link" data-scroll-target="#roc-curves">ROC curves</a></li>
  <li><a href="#roc-auc" id="toc-roc-auc" class="nav-link" data-scroll-target="#roc-auc">ROC-AUC</a></li>
  <li><a href="#roc-pr" id="toc-roc-pr" class="nav-link" data-scroll-target="#roc-pr">ROC-PR</a></li>
  <li><a href="#deviance" id="toc-deviance" class="nav-link" data-scroll-target="#deviance">Deviance</a></li>
  </ul></li>
  <li><a href="#example-south-african-heart-disease" id="toc-example-south-african-heart-disease" class="nav-link" data-scroll-target="#example-south-african-heart-disease">Example: South African heart disease</a>
  <ul class="collapse">
  <li><a href="#group-discussion" id="toc-group-discussion" class="nav-link" data-scroll-target="#group-discussion">Group discussion</a></li>
  <li><a href="#data-set" id="toc-data-set" class="nav-link" data-scroll-target="#data-set">Data set</a></li>
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description">Data description</a></li>
  <li><a href="#logistic-regression-1" id="toc-logistic-regression-1" class="nav-link" data-scroll-target="#logistic-regression-1">Logistic regression</a></li>
  <li><a href="#ridge-logistic-regression" id="toc-ridge-logistic-regression" class="nav-link" data-scroll-target="#ridge-logistic-regression">Ridge logistic regression</a></li>
  <li><a href="#lasso-logistic-regression" id="toc-lasso-logistic-regression" class="nav-link" data-scroll-target="#lasso-logistic-regression">Lasso logistic regression</a></li>
  <li><a href="#elastic-net-logistic-regression" id="toc-elastic-net-logistic-regression" class="nav-link" data-scroll-target="#elastic-net-logistic-regression">Elastic net logistic regression</a></li>
  </ul></li>
  <li><a href="#computational-details-for-the-glmnet" id="toc-computational-details-for-the-glmnet" class="nav-link" data-scroll-target="#computational-details-for-the-glmnet">Computational details for the glmnet</a>
  <ul class="collapse">
  <li><a href="#software-links" id="toc-software-links" class="nav-link" data-scroll-target="#software-links">Software links</a></li>
  <li><a href="#glmnet-inputs" id="toc-glmnet-inputs" class="nav-link" data-scroll-target="#glmnet-inputs">glmnet inputs</a></li>
  <li><a href="#cv.glmnet-inputs" id="toc-cv.glmnet-inputs" class="nav-link" data-scroll-target="#cv.glmnet-inputs">cv.glmnet inputs</a>
  <ul class="collapse">
  <li><a href="#family" id="toc-family" class="nav-link" data-scroll-target="#family">Family</a></li>
  <li><a href="#penalties" id="toc-penalties" class="nav-link" data-scroll-target="#penalties">Penalties</a></li>
  <li><a href="#additional-modifications" id="toc-additional-modifications" class="nav-link" data-scroll-target="#additional-modifications">Additional modifications</a></li>
  </ul></li>
  <li><a href="#lasso-variants" id="toc-lasso-variants" class="nav-link" data-scroll-target="#lasso-variants">Lasso variants</a></li>
  </ul></li>
  <li><a href="#preparing-for-inference-for-the-lasso-and-ridge" id="toc-preparing-for-inference-for-the-lasso-and-ridge" class="nav-link" data-scroll-target="#preparing-for-inference-for-the-lasso-and-ridge">Preparing for inference for the lasso and ridge</a>
  <ul class="collapse">
  <li><a href="#confidence-interval" id="toc-confidence-interval" class="nav-link" data-scroll-target="#confidence-interval">Confidence interval</a></li>
  <li><a href="#bootstrap-confidence-intervals" id="toc-bootstrap-confidence-intervals" class="nav-link" data-scroll-target="#bootstrap-confidence-intervals">Bootstrap confidence intervals</a></li>
  <li><a href="#percentile-interval" id="toc-percentile-interval" class="nav-link" data-scroll-target="#percentile-interval">Percentile interval</a></li>
  <li><a href="#bias-corrected-accelerated-interval" id="toc-bias-corrected-accelerated-interval" class="nav-link" data-scroll-target="#bias-corrected-accelerated-interval">Bias corrected accelerated interval</a></li>
  <li><a href="#single-hypothesis-test" id="toc-single-hypothesis-test" class="nav-link" data-scroll-target="#single-hypothesis-test">Single hypothesis test</a></li>
  <li><a href="#p-value" id="toc-p-value" class="nav-link" data-scroll-target="#p-value"><span class="math inline">\(p\)</span>-value</a></li>
  <li><a href="#from-single-to-multiple-hypotheses" id="toc-from-single-to-multiple-hypotheses" class="nav-link" data-scroll-target="#from-single-to-multiple-hypotheses">From single to multiple hypotheses</a></li>
  <li><a href="#familywise-error-rate" id="toc-familywise-error-rate" class="nav-link" data-scroll-target="#familywise-error-rate">Familywise error rate</a></li>
  <li><a href="#the-bonferroni-method-controls-the-fwer" id="toc-the-bonferroni-method-controls-the-fwer" class="nav-link" data-scroll-target="#the-bonferroni-method-controls-the-fwer">The Bonferroni method controls the FWER</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MA8701 Advanced methods in statistical inference and learning</h1>
<p class="subtitle lead">L10: Shrinkage methods for the GLM</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mette Langaas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="before-we-begin" class="level1">
<h1>Before we begin</h1>
<section id="literature" class="level2">
<h2 class="anchored" data-anchor-id="literature">Literature</h2>
<ul>
<li><p>[ELS] The Elements of Statistical Learning: Data Mining, Inference, and Prediction, Second Edition (Springer Series in Statistics, 2009) by Trevor Hastie, Robert Tibshirani, and Jerome Friedman. <a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf">Ebook</a>. Chapter 4.4.1-4.4.3 (4.4.4 is covered in 3.2 of HTW).</p></li>
<li><p>[HTW] Hastie, Tibshirani, Wainwright: “Statistical Learning with Sparsity: The Lasso and Generalizations”. CRC press. <a href="https://hastie.su.domains/StatLearnSparsity/">Ebook</a>. Chapter 3.2,3.7, 5.4.3</p></li>
</ul>
<p>and for the interested student</p>
<ul>
<li>[WNvW] <a href="https://arxiv.org/pdf/1509.09169v7.pdf">Wessel N. van Wieringen: Lecture notes on ridge regression</a> Chapter 5.</li>
</ul>
<hr>
<p>Supplemental sources useful for week 6 (see also the section on “Preparing for inference for the lasso and ridge”)</p>
<ul>
<li><a href="https://ntnuopen.ntnu.no/ntnu-xmlui/handle/11250/3026839">Bootstrap confidence intervals in the master thesis of Lene Tillerli Omdal Section 3.6.2</a> and teaching material from TMA4300 - see the wikipage for that course.</li>
<li><a href="https://www.math.ntnu.no/emner/TMA4267/2017v/multtest.pdf">Short note on multiple hypothesis testing</a> in TMA4267 Linear Statistical Models, Kari K. Halle, Øyvind Bakke and Mette Langaas, March 15, 2017.</li>
</ul>
<hr>
<!-- # Multiple imputation combined with shrinkage methods -->
<!-- ## First case -->
<!-- Assume that the aim is prediction, and only this is studied for model assessment (no need for hypothesis tests or confidence intervals for regression parameters). -->
<!-- Further assume that there is enough data to set aside a test set for model assessment, maybe 20-80 split. -->
<!-- How is it now possible to combine multiple imputation and lasso/ridge type methods on the training set? -->
<!-- "Tja" - if Rubins rules could be used on the predictions on the test set? -->
<!-- --- -->
<!-- ## Second case -->
<!-- Assume that the aim is model selection (find the important covariates) and that inference about the fitted coefficients is of interest. -->
<!-- We will in W6 learn how to used bootstrapping to provide a confidence interval for the regression coefficients, such that there needs to be a bootstrap loop. -->
<!-- How can now multiple imputation, lasso/ridge type method (which need bootsrapping) be combined? -->
<!-- --- -->
<!-- ## Short review of a few solution -->
<!-- Warning: this is an area of research with few good solutions! Aka _"a fertile ground for further research"_ -->
<!-- @ZhaoLong2017: "Variable selection in the presence of missing data: imputation-based methods" lists three stragegies. (NB: here model assessment is not discussed, only model selection) -->
<!-- 1) Apply existing variable selection methods to each imputed dataset and then combine variable selection results across all imputed datasets. -->
<!-- This is similar to what I presented for the suicide crisis syndrome data set, and is presented in @vanBuuren Section 5.4 Stepwise model selection, in particular 5.4.2 for the D1 method that is implemented in the MICE R package.  -->
<!-- It is not clear how this should be done if the model selection method is a lasso variant. Could the penalty parameter be decided using Rubins rules and then used to fit lasso on each data set again and would then the same model be selected for each imputed data set?  -->
<!-- 2) Apply existing variable selection methods to stacked imputed datasets. -->
<!-- 3) Combine resampling techniques (such as bootstrap) with imputation -->
<!-- ## MI and model assessment -->
<!-- If ridge regression is used, then the same active set is used for each of the imputed data sets, and in addition we know that the parameter estimates are normally distributed (however biased). This means that model selection is not performed (except for hyperparameter tuning which is done using cross-validation for data set). Is it wise to use Rubin´s rules for the ridge regression coefficients when these are biased? -->
<!-- When searching for literature: some may use ridge/lasso for the imputation model in the multiple imputation, but we are interested in using ridge/lasso as the analysis model -->
</section>
</section>
<section id="generalized-linear-models" class="level1">
<h1>Generalized linear models</h1>
<p>(HTW 3.1, 3.2, and TMA4315 GLM background)</p>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<p>The GLM model has three ingredients:</p>
<ol type="1">
<li>Random component</li>
<li>Systematic component</li>
<li>Link function</li>
</ol>
<p>We look into that for the binomial distribution - to get multiple linear regression and logistic regression.</p>
<ul>
<li>Write in class</li>
</ul>
<hr>
</section>
<section id="explaining-beta-in-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="explaining-beta-in-logistic-regression">Explaining <span class="math inline">\(\beta\)</span> in logistic regression</h2>
<ul>
<li><p>The ratio <span class="math inline">\(\frac{P(Y_i=1)}{P(Y_i=0)}=\frac{\pi_i}{1-\pi_1}\)</span> is called the <em>odds</em>.</p></li>
<li><p>If <span class="math inline">\(\pi_i=\frac{1}{2}\)</span> then the odds is <span class="math inline">\(1\)</span>, and if <span class="math inline">\(\pi_i=\frac{1}{4}\)</span> then the odds is <span class="math inline">\(\frac{1}{3}\)</span>. We may make a table for probability vs.&nbsp;odds in R:</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;"> pivec </td>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 0.40 </td>
   <td style="text-align:right;"> 0.5 </td>
   <td style="text-align:right;"> 0.6 </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 0.8 </td>
   <td style="text-align:right;"> 0.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> odds </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.25 </td>
   <td style="text-align:right;"> 0.43 </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> 1.0 </td>
   <td style="text-align:right;"> 1.5 </td>
   <td style="text-align:right;"> 2.33 </td>
   <td style="text-align:right;"> 4.0 </td>
   <td style="text-align:right;"> 9.0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ul>
<li>Odds may be seen to be a better scale than probability to represent chance, and is used in betting. In addition, odds are unbounded above.</li>
</ul>
<hr>
<p>We look at the link function (inverse of the response function). Let us assume that our linear predictor has <span class="math inline">\(k\)</span> covariates present</p>
<p><span class="math display">\[\begin{align*}
\eta_i&amp;= \beta_0+\beta_1 x_{i1}+\beta_2 x_{i2}+\cdots + \beta_k x_{ik}\\
\pi_i&amp;= \frac{\exp(\eta_i)}{1+\exp(\eta_i)}\\
\eta_i&amp;=\ln(\frac{\pi_i}{1-\pi_i})\\
\ln(\frac{\pi_i}{1-\pi_i})&amp;=\beta_0+\beta_1 x_{i1}+\beta_2 x_{i2}+\cdots + \beta_k x_{ik}\\
\frac{\pi_i}{1-\pi_i}=&amp;\frac{P(Y_i=1)}{P(Y_i=0)}=\exp(\beta_0)\cdot \exp(\beta_1 x_{i1})\cdots\exp(\beta_k x_{ik})
\end{align*}\]</span></p>
<p>We have a <em>multiplicative model</em> for the odds.</p>
<hr>
<p><strong>So, what if we increase <span class="math inline">\(x_{1i}\)</span> to <span class="math inline">\(x_{1i}+1\)</span>?</strong></p>
<p>If the covariate <span class="math inline">\(x_{1i}\)</span> increases by one unit (while all other covariates are kept fixed) then the odds is multiplied by <span class="math inline">\(\exp(\beta_1)\)</span>:</p>
<p><span class="math display">\[\begin{align*}
\frac{P(Y_i=1\mid x_{i1}+1)}{P(Y_i=0)\mid x_{i1}+1)}&amp;=\exp(\beta_0)\cdot \exp(\beta_1 (x_{i1}+1))\cdots\exp(\beta_k x_{ik})\\
&amp;=\exp(\beta_0)\cdot \exp(\beta_1 x_{i1})\exp(\beta_1)\cdots\exp(\beta_k x_{ik})\\
&amp;=\frac{P(Y_i=1\mid x_{i1})}{P(Y_i=0\mid x_{i1})}\cdot \exp(\beta_1)\\
\end{align*}\]</span></p>
<p>This means that if <span class="math inline">\(x_{i1}\)</span> increases by <span class="math inline">\(1\)</span> then: if <span class="math inline">\(\beta_1&lt;0\)</span> we get a decrease in the odds, if <span class="math inline">\(\beta_1=0\)</span> no change, and if <span class="math inline">\(\beta_1&gt;0\)</span> we have an increase. In the logit model <span class="math inline">\(\exp(\beta_1)\)</span> is easier to interpret than <span class="math inline">\(\beta_1\)</span>.</p>
<hr>
<p>The response function as a function of the covariate <span class="math inline">\(x\)</span> and not of <span class="math inline">\(\eta\)</span>. Solid lines: <span class="math inline">\(\beta_0=0\)</span> and <span class="math inline">\(\beta_1\)</span> is <span class="math inline">\(0.8\)</span> (blue), <span class="math inline">\(1\)</span> (red) and <span class="math inline">\(2\)</span> (orange), and dashed lines with <span class="math inline">\(\beta_0=1\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="parameter-estimation" class="level2">
<h2 class="anchored" data-anchor-id="parameter-estimation">Parameter estimation</h2>
<p>First logistic regression, then ridge and lasso logistic regression - and (maybe) elastic net logistic regression.</p>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h3>
<ul>
<li><p>Maximum likelihood estimation = maximize the likelihood of the data. We write for the loglikelihood <span class="math inline">\({\cal{l}}(\beta_0,\beta; {\boldsymbol y}, {\boldsymbol X})\)</span>.</p></li>
<li><p>We write out the loglikelihood for the binomial with logit link =logistic regression.</p></li>
</ul>
<hr>
</section>
<section id="algorithms" class="level3">
<h3 class="anchored" data-anchor-id="algorithms">Algorithms</h3>
<p>To understand the ridge and lasso logistic regression we first look at the <em>iteratively reweighted least squares</em> (IRLS) - as a result of the Newton Raphson method for the logistic regression (unpenalized).</p>
</section>
<section id="properties" class="level3">
<h3 class="anchored" data-anchor-id="properties">Properties</h3>
<p>The parameter estimator is asymptotically normal. Unbiased with variance the inverse of the Fisher information matrix - as known TMA4315.</p>
<hr>
<p>In class we now scroll down to the South African data set and look at the data and the logistic regression.</p>
<hr>
</section>
<section id="penalized-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="penalized-logistic-regression">Penalized logistic regression</h3>
<ul>
<li><p>For penalized method we instead minimize the negative loglikelihood scaled with <span class="math inline">\(\frac{1}{N}\)</span>.</p></li>
<li><p>The ridge and lasso penalty is added to the scaled negative loglikelihood.</p></li>
<li><p>Write in class</p></li>
</ul>
<hr>
</section>
<section id="algorithms-1" class="level3">
<h3 class="anchored" data-anchor-id="algorithms-1">Algorithms</h3>
<ul>
<li>The likelihood for the GLM is differentiable, and the ridge and lasso objective functions are convex - and can be solved with socalled “standard convex optimization methods”.</li>
<li>But, by popular demand also special algorithms are available - building on the cyclic coordinate descent.</li>
</ul>
</section>
<section id="ridge-logistic-regression-irwls" class="level3">
<h3 class="anchored" data-anchor-id="ridge-logistic-regression-irwls">Ridge logistic regression IRWLS</h3>
<hr>
</section>
<section id="lasso-logistic-regression-fitting-algoritm" class="level3">
<h3 class="anchored" data-anchor-id="lasso-logistic-regression-fitting-algoritm">Lasso logistic regression fitting algoritm</h3>
<p>(HTW page 116)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>OUTER LOOP<span class="sc">:</span> start with lambdamax and decrement</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      MIDDLE <span class="fu">LOOP</span> (with warm start) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         compute quadratic approximation </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> current beta<span class="sc">-</span>estimates</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              INNER LOOP<span class="sc">:</span> cyclic coordinate descent</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              to minimize quadratic approximation </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              added the lasso penalty</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="criteria-for-choosing-lambda" class="level3">
<h3 class="anchored" data-anchor-id="criteria-for-choosing-lambda">Criteria for choosing <span class="math inline">\(\lambda\)</span></h3>
<p>We use cross-validation to choose <span class="math inline">\(\lambda\)</span>.</p>
<p>For regression we choose <span class="math inline">\(\lambda\)</span> by minimizing the (mean) squared error.</p>
<p>For (ridge and) lasso logistic regression we may choose:</p>
<ul>
<li>misclassification error rate on the validation set</li>
<li>ROC-AUC or PR-AUC</li>
<li>binomial deviance</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="evaluation-metrics" class="level1">
<h1>Evaluation metrics</h1>
<section id="confusion-matrix-sensitivity-specificity" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-sensitivity-specificity">Confusion matrix, sensitivity, specificity</h2>
<p>(from TMA4268)</p>
<p>In a two class problem - assume the classes are labelled “-” (non disease,0) and “+” (disease,1). In a population setting we define the following event and associated number of observations.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Predicted -</th>
<th style="text-align: left;">Predicted +</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">True -</td>
<td style="text-align: left;">True Negative TN</td>
<td style="text-align: left;">False Positive FP</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">True +</td>
<td style="text-align: left;">False Negative FN</td>
<td style="text-align: left;">True Positive TP</td>
<td style="text-align: left;">P</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">N*</td>
<td style="text-align: left;">P*</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>(N in this context not to be confused with our sample size…)</p>
<hr>
<p><strong>Sensitivity</strong> (recall) is the proportion of correctly classified positive observations: <span class="math inline">\(\frac{\# \text{True Positive}}{\# \text{Condition Positive}}=\frac{\text{TP}}{\text{P}}\)</span>.</p>
<p><strong>Specificity</strong> is the proportion of correctly classified negative observations: <span class="math inline">\(\frac{\# \text{True Negative}}{\# \text{Condition Negative}}=\frac{\text{TN}}{\text{N}}\)</span>.</p>
<p>We would like that a classification rule have both a high sensitivity and a high specificity.</p>
<hr>
<p>Other useful quantities:</p>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 21%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Definition</th>
<th style="text-align: left;">Synonoms</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">False positive rate</td>
<td style="text-align: left;">FP/N</td>
<td style="text-align: left;">Type I error, 1-specificity</td>
</tr>
<tr class="even">
<td style="text-align: left;">True positive rate</td>
<td style="text-align: left;">TP/P</td>
<td style="text-align: left;">1-Type II error, power, sensitivity, recall</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Positive predictive value (PPV)</td>
<td style="text-align: left;">TP/P*</td>
<td style="text-align: left;">Precision, 1-false discovery proportion</td>
</tr>
<tr class="even">
<td style="text-align: left;">Negative predictive value (NPV)</td>
<td style="text-align: left;">TN/N*</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Where the PPV can be used together with the sensitivity to make a precision-recall curve more suitable for low case rates.</p>
<hr>
</section>
<section id="roc-curves" class="level2">
<h2 class="anchored" data-anchor-id="roc-curves">ROC curves</h2>
<p>(also from TMA4268)</p>
<p>The receiver operating characteristics (ROC) curve gives a graphical display of the sensitivity against specificity, as the threshold value (cut-off on probability of success or disease) is moved over the range of all possible values. An ideal classifier will give a ROC curve which hugs the top left corner, while a straight line represents a classifier with a random guess of the outcome.</p>
<hr>
</section>
<section id="roc-auc" class="level2">
<h2 class="anchored" data-anchor-id="roc-auc">ROC-AUC</h2>
<ul>
<li>The <strong>ROC-AUC</strong> score is the area under the ROC curve. It ranges between the values 0 and 1, where a higher value indicates a better classifier. <!-- An AUC score equal to 1 would imply that all observations are correctly classified.  --></li>
<li>The AUC score is useful for comparing the performance of different classifiers, as all possible threshold values are taken into account.</li>
<li>The ROC-AUC is closely connected to the robust U statistics.</li>
<li>If the prevalence (case proportion) is very low (0.01ish), the ROC-AUC may be misleading, and the PR-AUC is more commonly used.</li>
</ul>
<hr>
</section>
<section id="roc-pr" class="level2">
<h2 class="anchored" data-anchor-id="roc-pr">ROC-PR</h2>
<p>To be added.</p>
<hr>
</section>
<section id="deviance" class="level2">
<h2 class="anchored" data-anchor-id="deviance">Deviance</h2>
<p>The <em>deviance</em> is based on the likelihood ratio test statistic.</p>
<p>The derivation assumes that data can be grouped into covariate patterns, with <span class="math inline">\(G\)</span> groups (else interval solutions are used in practice).</p>
<p><strong>Saturated model:</strong> If we were to provide a perfect fit to our data then we would estimate <span class="math inline">\(\pi_j\)</span> by the observed frequency for the group, <span class="math inline">\(\hat{y}_j=y_j\)</span>.</p>
<p><strong>Candidate model:</strong> the model with the current choice of <span class="math inline">\(\lambda\)</span>.</p>
<p><span class="math display">\[D_{\lambda}=2(l(\text{saturated model})-l(\text{candidate model}_{\lambda}))\]</span> The <strong>null deviance</strong> is replacing the candidate model with a model where <span class="math inline">\(\hat{y}_i=\frac{1}{N}\sum_{i=1}^N y_i\)</span> (the case proportion).</p>
<hr>
</section>
</section>
<section id="example-south-african-heart-disease" class="level1">
<h1>Example: South African heart disease</h1>
<p>(ELS 4.4.2)</p>
<section id="group-discussion" class="level2">
<h2 class="anchored" data-anchor-id="group-discussion">Group discussion</h2>
<p>Comment on what is done and the results. Where are the CIs and <span class="math inline">\(p\)</span>-values for the ridge and lasso version?</p>
<hr>
</section>
<section id="data-set" class="level2">
<h2 class="anchored" data-anchor-id="data-set">Data set</h2>
<p>The data is presented in ELS Section 4.4.2, and downloaded from <a href="http://statweb.stanford.edu/~tibs/ElemStatLearn.1stEd/" class="uri">http://statweb.stanford.edu/~tibs/ElemStatLearn.1stEd/</a> with information in the file <code>SAheat.info</code> and data in <code>SAheart.data</code>.</p>
<ul>
<li>This is a retrospective sample of males in a heart-disease high-risk region in South Africa.</li>
<li>It consists of 462 observations on the 10 variables. All subjects are male in the age range 15-64.</li>
<li>There are 160 cases (individuals who have suffered from a conorary heart disease) and 302 controls (individuals who have not suffered from a conorary heart disease).<br>
</li>
<li>The overall prevalence in the region was 5.1%.</li>
</ul>
<hr>
<p>The response value (<code>chd</code>) and covariates</p>
<ul>
<li><code>chd</code> : conorary heart disease {yes, no} coded by the numbers {1, 0}</li>
<li><code>sbp</code> : systolic blood pressure<br>
</li>
<li><code>tobacco</code> : cumulative tobacco (kg)<br>
</li>
<li><code>ldl</code> : low density lipoprotein cholesterol</li>
<li><code>adiposity</code> : a numeric vector</li>
<li><code>famhist</code> : family history of heart disease. Categorical variable with two levels: {Absent, Present}.</li>
<li><code>typea</code> : type-A behavior</li>
<li><code>obesity</code> : a numerical value</li>
<li><code>alcohol</code> : current alcohol consumption</li>
<li><code>age</code> : age at onset</li>
</ul>
<p><em>The goal is to identify important risk factors.</em></p>
<hr>
</section>
<section id="data-description" class="level2">
<h2 class="anchored" data-anchor-id="data-description">Data description</h2>
<p>We start by loading and looking at the data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ds<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">"./SAheart.data"</span>,<span class="at">sep=</span><span class="st">","</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ds<span class="sc">$</span>chd<span class="ot">=</span><span class="fu">as.factor</span>(ds<span class="sc">$</span>chd)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ds<span class="sc">$</span>famhist<span class="ot">=</span><span class="fu">as.factor</span>(ds<span class="sc">$</span>famhist)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 462  10</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sbp"       "tobacco"   "ldl"       "adiposity" "famhist"   "typea"    
 [7] "obesity"   "alcohol"   "age"       "chd"      </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  sbp tobacco  ldl adiposity famhist typea obesity alcohol age chd
1 160   12.00 5.73     23.11 Present    49   25.30   97.20  52   1
2 144    0.01 4.41     28.61  Absent    55   28.87    2.06  63   1
3 118    0.08 3.48     32.28 Present    52   29.14    3.81  46   0
4 170    7.50 6.41     38.03 Present    51   31.99   24.26  58   1
5 134   13.60 3.50     27.78 Present    60   25.99   57.34  49   1
6 132    6.20 6.47     36.21 Present    62   30.77   14.14  45   0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to be easier to compare with lasso and ridge, we standardize the xs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>xs<span class="ot">=</span><span class="fu">model.matrix</span>(chd<span class="sc">~</span>.,<span class="at">data=</span>ds)[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># to take care of categorical variables, but not include the intercept column</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>xss<span class="ot">=</span><span class="fu">scale</span>(xs)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>ys<span class="ot">=</span><span class="fu">as.numeric</span>(ds[,<span class="dv">10</span>])<span class="sc">-</span><span class="dv">1</span> <span class="co"># not factor, must be numeric else errors...</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         sbp    tobacco        ldl  adiposity famhistPresent      typea
1  1.0574173  1.8210988  0.4778941 -0.2951832      1.1845700 -0.4180170
2  0.2767892 -0.7893817 -0.1595071  0.4116942     -0.8423609  0.1931344
3 -0.9917313 -0.7741412 -0.6085852  0.8833742      1.1845700 -0.1124413
4  1.5453098  0.8413521  0.8062523  1.6223824      1.1845700 -0.2142999
5 -0.2111033  2.1694532 -0.5989276  0.3050200      1.1845700  0.7024273
6 -0.3086818  0.5583142  0.8352251  1.3884702      1.1845700  0.9061444
      obesity    alcohol       age
1 -0.17659445  3.2741887 0.6286543
2  0.67064592 -0.6120811 1.3816170
3  0.73472292 -0.5405973 0.2179473
4  1.41109128  0.2947424 1.0393612
5 -0.01284211  1.6459912 0.4233008
6  1.12155816 -0.1186384 0.1494961</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ys
  0   1 
302 160 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dss<span class="ot">=</span><span class="fu">data.frame</span>(ys,xss)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dss)[<span class="dv">1</span>]<span class="ot">=</span><span class="st">"chd"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(dss,<span class="dv">2</span>,sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           chd            sbp        tobacco            ldl      adiposity 
     0.4763125      1.0000000      1.0000000      1.0000000      1.0000000 
famhistPresent          typea        obesity        alcohol            age 
     1.0000000      1.0000000      1.0000000      1.0000000      1.0000000 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(dss,<span class="dv">2</span>,mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           chd            sbp        tobacco            ldl      adiposity 
  3.463203e-01   1.289252e-16   5.166622e-16  -3.961057e-15   1.557677e-15 
famhistPresent          typea        obesity        alcohol            age 
 -3.892990e-17  -9.924721e-17  -5.292544e-15  -6.411418e-16  -3.953067e-17 </code></pre>
</div>
</div>
<p>The coloring is done according to the response variable, where green represents a case <span class="math inline">\(Y=1\)</span> and red represents a control <span class="math inline">\(Y=0\)</span>.</p>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Q:</strong> Comment on the correlation between covariates, and what that may lead to?</p>
<hr>
</section>
<section id="logistic-regression-1" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-1">Logistic regression</h2>
<p>We now fit a (multiple) logistic regression model using the <code>glm</code> function and the full data set. In order to fit a logistic model, the <code>family</code> argument must be set equal to <code>="binomial"</code>. The <code>summary</code> function prints out the estimates of the coefficients, their standard errors and z-values. As for a linear regression model, the significant coefficients are indicated by stars where the significant codes are included in the <code>R</code> printout.</p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>glm_heart <span class="ot">=</span> <span class="fu">glm</span>(chd<span class="sc">~</span>.,<span class="at">data=</span>dss, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_heart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ ., family = "binomial", data = dss)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7781  -0.8213  -0.4387   0.8889   2.5435  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -0.878545   0.123218  -7.130  1.0e-12 ***
sbp             0.133308   0.117452   1.135 0.256374    
tobacco         0.364578   0.122187   2.984 0.002847 ** 
ldl             0.360181   0.123554   2.915 0.003555 ** 
adiposity       0.144616   0.227892   0.635 0.525700    
famhistPresent  0.456538   0.112433   4.061  4.9e-05 ***
typea           0.388726   0.120954   3.214 0.001310 ** 
obesity        -0.265082   0.186446  -1.422 0.155095    
alcohol         0.002978   0.109754   0.027 0.978350    
age             0.660695   0.177203   3.728 0.000193 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 596.11  on 461  degrees of freedom
Residual deviance: 472.14  on 452  degrees of freedom
AIC: 492.14

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(glm_heart))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)            sbp        tobacco            ldl      adiposity 
     0.4153868      1.1426023      1.4399061      1.4335883      1.1555963 
famhistPresent          typea        obesity        alcohol            age 
     1.5785989      1.4750996      0.7671430      1.0029829      1.9361378 </code></pre>
</div>
</div>
<hr>
<p>A very surprising result here is that <code>sbp</code> and <code>obesity</code> are NOT significant and <code>obesity</code> has negative sign. This is a result of the correlation between covariates. In separate models with only <code>sbp</code> or only <code>obesity</code> each is positive and significant.</p>
<p><strong>Q:</strong> How would you interpret the estimated coefficient for <code>tobacco</code>?</p>
<hr>
</section>
<section id="ridge-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="ridge-logistic-regression">Ridge logistic regression</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ridgefit<span class="ot">=</span><span class="fu">glmnet</span>(<span class="at">x=</span>xss,<span class="at">y=</span>ys,<span class="at">alpha=</span><span class="dv">0</span>,<span class="at">standardize=</span><span class="cn">FALSE</span>,<span class="at">family=</span><span class="st">"binomial"</span>) <span class="co"># already standardized</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridgefit,<span class="at">xvar=</span><span class="st">"lambda"</span>,<span class="at">label=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The lamda giving the smallest CV error 0.0177267348467831"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The 1sd err method lambda 0.218543472568106"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>10 x 2 sparse Matrix of class "dgCMatrix"
                        s1             
(Intercept)    -0.71220689 -0.878545196
sbp             0.10221203  0.133308398
tobacco         0.21846208  0.364577926
ldl             0.18656817  0.360180594
adiposity       0.11163533  0.144616485
famhistPresent  0.23181050  0.456537713
typea           0.13189202  0.388725509
obesity        -0.03579032 -0.265082072
alcohol         0.01941844  0.002978424
age             0.28192570  0.660695163</code></pre>
</div>
</div>
<hr>
</section>
<section id="lasso-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="lasso-logistic-regression">Lasso logistic regression</h2>
<p>Numbering in plots is order of covariates, so:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="fu">colnames</span>(xss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]            
 [1,] "1"  "sbp"           
 [2,] "2"  "tobacco"       
 [3,] "3"  "ldl"           
 [4,] "4"  "adiposity"     
 [5,] "5"  "famhistPresent"
 [6,] "6"  "typea"         
 [7,] "7"  "obesity"       
 [8,] "8"  "alcohol"       
 [9,] "9"  "age"           </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lassofit<span class="ot">=</span><span class="fu">glmnet</span>(<span class="at">x=</span>xss,<span class="at">y=</span>ys,<span class="at">alpha=</span><span class="dv">1</span>,<span class="at">standardize=</span><span class="cn">FALSE</span>,<span class="at">family=</span><span class="st">"binomial"</span>) <span class="co"># already standardized</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The lamda giving the smallest CV error 0.00903024338615681"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The 1sd err method lambda 0.052890323504839"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>10 x 3 sparse Matrix of class "dgCMatrix"
                     lasso       ridge     logistic
(Intercept)    -0.70977228 -0.71220689 -0.878545196
sbp             .           0.10221203  0.133308398
tobacco         0.18103811  0.21846208  0.364577926
ldl             0.14726886  0.18656817  0.360180594
adiposity       .           0.11163533  0.144616485
famhistPresent  0.22246385  0.23181050  0.456537713
typea           0.01954765  0.13189202  0.388725509
obesity         .          -0.03579032 -0.265082072
alcohol         .           0.01941844  0.002978424
age             0.43990121  0.28192570  0.660695163</code></pre>
</div>
</div>
<hr>
</section>
<section id="elastic-net-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="elastic-net-logistic-regression">Elastic net logistic regression</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="fu">colnames</span>(xss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]            
 [1,] "1"  "sbp"           
 [2,] "2"  "tobacco"       
 [3,] "3"  "ldl"           
 [4,] "4"  "adiposity"     
 [5,] "5"  "famhistPresent"
 [6,] "6"  "typea"         
 [7,] "7"  "obesity"       
 [8,] "8"  "alcohol"       
 [9,] "9"  "age"           </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>elfit<span class="ot">=</span><span class="fu">glmnet</span>(<span class="at">x=</span>xss,<span class="at">y=</span>ys,<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">standardize=</span><span class="cn">FALSE</span>,<span class="at">family=</span><span class="st">"binomial"</span>) <span class="co"># already standardized</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The lamda giving the smallest CV error 0.00822802145212431"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The 1sd err method lambda 0.0302657876716661"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="L10_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>10 x 4 sparse Matrix of class "dgCMatrix"
                    elactic       lasso       ridge     logistic
(Intercept)    -0.787051709 -0.70977228 -0.71220689 -0.878545196
sbp             0.068908933  .           0.10221203  0.133308398
tobacco         0.296131971  0.18103811  0.21846208  0.364577926
ldl             0.259807431  0.14726886  0.18656817  0.360180594
adiposity       .            .           0.11163533  0.144616485
famhistPresent  0.351410691  0.22246385  0.23181050  0.456537713
typea           0.217807228  0.01954765  0.13189202  0.388725509
obesity        -0.003273359  .          -0.03579032 -0.265082072
alcohol         .            .           0.01941844  0.002978424
age             0.544428773  0.43990121  0.28192570  0.660695163</code></pre>
</div>
</div>
</section>
</section>
<section id="computational-details-for-the-glmnet" class="level1">
<h1>Computational details for the glmnet</h1>
<p>(HTW 3.7)</p>
<p><code>glmnet</code> is the implementation in R of the elastic net from HTW-book, and the package is maintained by Trevor Hastie.</p>
<p>The package fits generalized linear models using penalized maximum likelihood of elastic net type (lasso and ridge are special cases).</p>
<p>The logistic lasso is fitted using a quadratic approximation for the negative log-likelihood in a “proximal-Newton iterative approach”.</p>
<section id="software-links" class="level2">
<h2 class="anchored" data-anchor-id="software-links">Software links</h2>
<ul>
<li><a href="https://cran.r-project.org/web/packages/glmnet/index.html">R glmnet on CRAN</a> with <a href="http://www.stanford.edu/~hastie/glmnet">resources</a>.
<ul>
<li><a href="https://glmnet.stanford.edu/articles/glmnet.html">Getting started</a></li>
<li><a href="https://glmnet.stanford.edu/articles/glmnetFamily.html">GLM with glmnet</a></li>
</ul></li>
</ul>
<hr>
<p>For Python there are different options.</p>
<ul>
<li><a href="https://web.stanford.edu/~hastie/glmnet_python/">Python glmnet</a> is recommended by Hastie et al.</li>
<li><a href="https://scikit-learn.org/stable/modules/linear_model.html#ridge-regression-and-classification">scikit-learn</a> (seems to mostly be for regression? is there lasso for classification here?)</li>
</ul>
<hr>
</section>
<section id="glmnet-inputs" class="level2">
<h2 class="anchored" data-anchor-id="glmnet-inputs">glmnet inputs</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glmnet</span>(x, y, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a> <span class="at">family =</span> <span class="fu">c</span>(<span class="st">"gaussian"</span>, <span class="st">"binomial"</span>, <span class="st">"poisson"</span>, <span class="st">"multinomial"</span>,<span class="st">"cox"</span>, <span class="st">"mgaussian"</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a> <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="at">offset =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">nlambda =</span> <span class="dv">100</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a> <span class="at">lambda.min.ratio =</span> <span class="fu">ifelse</span>(nobs <span class="sc">&lt;</span> nvars, <span class="fl">0.01</span>, <span class="fl">1e-04</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a> <span class="at">lambda =</span> <span class="cn">NULL</span>, <span class="at">standardize =</span> <span class="cn">TRUE</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a> <span class="at">thresh =</span> <span class="fl">1e-07</span>, <span class="at">dfmax =</span> nvars <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a> <span class="at">pmax =</span> <span class="fu">min</span>(dfmax <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">20</span>, nvars), </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a> <span class="at">exclude =</span> <span class="cn">NULL</span>, <span class="at">penalty.factor =</span> <span class="fu">rep</span>(<span class="dv">1</span>, nvars),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a> <span class="at">lower.limits =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">upper.limits =</span> <span class="cn">Inf</span>, <span class="at">maxit =</span> <span class="fl">1e+05</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a> <span class="at">type.gaussian =</span> <span class="fu">ifelse</span>(nvars <span class="sc">&lt;</span> <span class="dv">500</span>, <span class="st">"covariance"</span>, <span class="st">"naive"</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a> <span class="at">type.logistic =</span> <span class="fu">c</span>(<span class="st">"Newton"</span>, <span class="st">"modified.Newton"</span>),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a> <span class="at">standardize.response =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a> <span class="at">type.multinomial =</span> <span class="fu">c</span>(<span class="st">"ungrouped"</span>,<span class="st">"grouped"</span>), </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a> <span class="at">relax =</span> <span class="cn">FALSE</span>, <span class="at">trace.it =</span> <span class="dv">0</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="cv.glmnet-inputs" class="level2">
<h2 class="anchored" data-anchor-id="cv.glmnet-inputs">cv.glmnet inputs</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glmnet</span>(x, y, <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="at">offset =</span> <span class="cn">NULL</span>, <span class="at">lambda =</span> <span class="cn">NULL</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">type.measure =</span> <span class="fu">c</span>(<span class="st">"default"</span>, <span class="st">"mse"</span>, <span class="st">"deviance"</span>, <span class="st">"class"</span>, <span class="st">"auc"</span>, <span class="st">"mae"</span>,<span class="st">"C"</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfolds =</span> <span class="dv">10</span>, <span class="at">foldid =</span> <span class="cn">NULL</span>, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">alignment =</span> <span class="fu">c</span>(<span class="st">"lambda"</span>, <span class="st">"fraction"</span>), <span class="at">grouped =</span> <span class="cn">TRUE</span>, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">keep =</span> <span class="cn">FALSE</span>, <span class="at">parallel =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="at">relax =</span> <span class="cn">FALSE</span>, <span class="at">trace.it =</span> <span class="dv">0</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>type.measure defaults to deviance (accoring to help(cv.glmnet)). The last is for Cox models.</p>
<hr>
<section id="family" class="level3">
<h3 class="anchored" data-anchor-id="family">Family</h3>
<p>we have only covered <code>gaussian</code> (the default) and <code>binomial</code>.</p>
<p>Each family has implemented the deviance measure. Poisson regression and Cox proportional hazard (survival analysis) is also implemented in glmnet.</p>
<hr>
</section>
<section id="penalties" class="level3">
<h3 class="anchored" data-anchor-id="penalties">Penalties</h3>
<p>The elastic net is implemented, with three possible adjustment parameters.</p>
<p><span class="math display">\[ \text{minimize}_{\beta_0,\beta} \{ -\frac{1}{N} l(y;\beta_0,\beta)+\lambda \sum_{j=1}^p
\gamma_j ((1-\alpha)\beta_j^2+\alpha \lvert \beta_j \rvert)\}\]</span></p>
<ul>
<li><span class="math inline">\(\lambda\)</span>: the penalty, default a grid of 100 values is chosen, to cover the lasso path on the log scale.</li>
<li><span class="math inline">\(\alpha\)</span>: elastic net parameter <span class="math inline">\(\in [0,1]\)</span>. This is usually manually selected by a grid search over 3-5 values. Default is <span class="math inline">\(\alpha=1\)</span> (lasso), and with <span class="math inline">\(\alpha=0\)</span> we get ridge.</li>
<li><span class="math inline">\(\gamma_j\)</span>: penalty modifier for each covariate to be able to always include (<span class="math inline">\(\gamma_j==0\)</span>), or exclude (<span class="math inline">\(\gamma_j=\text{Inf}\)</span>), or give individual penalty modifications. Default <span class="math inline">\(\lambda_j=1\)</span>.</li>
</ul>
<hr>
<p>For the <span class="math inline">\(\lambda\)</span> penalty the maximal value is for</p>
<ul>
<li>linear regression: <span class="math inline">\(\lambda_{\text max}=\text{max}_j \lvert \hat{\beta}_{LS,j} \rvert\)</span> (standardized coefficients) or, should there also be a factor 1/N?</li>
<li>logistic regression: <span class="math inline">\(\lambda_{\text max}=\text{max}_{j}\lvert {\boldsymbol x}_j ^T ({\boldsymbol y}-\bar{p}) \rvert\)</span> where <span class="math inline">\(\bar p\)</span> is the mean case rate.</li>
</ul>
</section>
<section id="additional-modifications" class="level3">
<h3 class="anchored" data-anchor-id="additional-modifications">Additional modifications</h3>
<ul>
<li>Coefficient bounds can be set (possible since coordinate descent is used)</li>
<li>Some coefficients can be excluded from the penalization (than thus forced in).</li>
<li>Offset can be added (popular if rate models for Poisson is used)</li>
<li>For binary and multinomial data factors or matrices can be input.</li>
<li>Sparse matrices with covariates can be supplied.</li>
</ul>
<hr>
</section>
</section>
<section id="lasso-variants" class="level2">
<h2 class="anchored" data-anchor-id="lasso-variants">Lasso variants</h2>
<p>Elastic net is already in glmnet (alpha-parameter).</p>
<p>Other lasso variants have their own R packages:</p>
<ul>
<li><p>The group lasso <a href="https://cran.r-project.org/web/packages/grplasso/grplasso.pdf" class="uri">https://cran.r-project.org/web/packages/grplasso/grplasso.pdf</a></p></li>
<li><p>The fused lasso <a href="https://cran.r-project.org/web/packages/genlasso/genlasso.pdf" class="uri">https://cran.r-project.org/web/packages/genlasso/genlasso.pdf</a></p></li>
<li><p>The sparse group lasso <a href="https://arxiv.org/pdf/2208.02942" class="uri">https://arxiv.org/pdf/2208.02942</a> and <a href="https://cran.r-project.org/web/packages/sparsegl/vignettes/sparsegl.html" class="uri">https://cran.r-project.org/web/packages/sparsegl/vignettes/sparsegl.html</a></p></li>
<li><p>Bayesian lasso blasso function for normal data in package monomvn <a href="https://rdrr.io/cran/monomvn/man/monomvn-package.html" class="uri">https://rdrr.io/cran/monomvn/man/monomvn-package.html</a></p></li>
<li><p>Elastic net for ordinal data: <a href="https://cran.r-project.org/web/packages/ordinalNet/ordinalNet.pdf" class="uri">https://cran.r-project.org/web/packages/ordinalNet/ordinalNet.pdf</a></p></li>
</ul>
</section>
</section>
<section id="preparing-for-inference-for-the-lasso-and-ridge" class="level1">
<h1>Preparing for inference for the lasso and ridge</h1>
<section id="confidence-interval" class="level2">
<h2 class="anchored" data-anchor-id="confidence-interval">Confidence interval</h2>
<p><strong>Set-up</strong></p>
<ul>
<li>We have a random sample <span class="math inline">\(Y_1,Y_2,\ldots,Y_N\)</span> from</li>
<li>some distribution <span class="math inline">\(F\)</span> with some (unkonwn) parameter <span class="math inline">\(\theta\)</span>.</li>
<li>Let <span class="math inline">\(y_1,y_2,\ldots,y_N\)</span> be the observed values for the random sample.</li>
</ul>
<p><strong>Statistics</strong></p>
<ul>
<li>We have two statistics <span class="math inline">\(\hat{\theta}_L(Y_1,Y_2,\ldots,Y_N)\)</span> and <span class="math inline">\(\hat{\theta}_U(Y_1,Y_2,\ldots,Y_N)\)</span> so that</li>
</ul>
<p><span class="math display">\[P(\hat{\theta}_L(Y_1,Y_2,\ldots,Y_N)\le \theta \le \hat{\theta}_U(Y_1,Y_2,\ldots,Y_N))=1-\alpha\]</span> where <span class="math inline">\(\alpha\in [0,1]\)</span></p>
<hr>
<p><strong>Confidence interval</strong></p>
<p>The numerical interval <span class="math display">\[[\hat{\theta}_L(y_1,y_2,\ldots,y_N),\hat{\theta}_U(y_1,y_2,\ldots,y_N)]\]</span> is called a <span class="math inline">\((1-\alpha)\)</span> 100% confidence interval.</p>
</section>
<section id="bootstrap-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-confidence-intervals">Bootstrap confidence intervals</h2>
</section>
<section id="percentile-interval" class="level2">
<h2 class="anchored" data-anchor-id="percentile-interval">Percentile interval</h2>
</section>
<section id="bias-corrected-accelerated-interval" class="level2">
<h2 class="anchored" data-anchor-id="bias-corrected-accelerated-interval">Bias corrected accelerated interval</h2>
<hr>
</section>
<section id="single-hypothesis-test" class="level2">
<h2 class="anchored" data-anchor-id="single-hypothesis-test">Single hypothesis test</h2>
<p><span class="math display">\[H_{0}\colon \beta_j=0 \hspace{0.5cm} \text{vs.} \hspace{0.5cm} H_{1}\colon \beta_j \neq 0\]</span></p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Not reject <span class="math inline">\(H_0\)</span></th>
<th style="text-align: left;">Reject <span class="math inline">\(H_0\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(H_0\)</span> true</td>
<td style="text-align: left;">Correct</td>
<td style="text-align: left;">Type I error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(H_0\)</span> false</td>
<td style="text-align: left;">Type II error</td>
<td style="text-align: left;">Correct</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>Two types of errors are possible, type I error and type II error.</li>
<li>A type I error would be to reject <span class="math inline">\(H_0\)</span> when <span class="math inline">\(H_0\)</span> is true, that is concluding that there is a linear association between the response and the predictor where there is no such association. This is called a <em>false positive finding</em>.</li>
<li>A type II error would be to fail to reject <span class="math inline">\(H_0\)</span> when the alternative hypothesis <span class="math inline">\(H_1\)</span> is true, that is not detecting that there is a linear association between the response and the covariate. This is called a <em>false negative finding</em>.</li>
</ul>
<hr>
</section>
<section id="p-value" class="level2">
<h2 class="anchored" data-anchor-id="p-value"><span class="math inline">\(p\)</span>-value</h2>
<ul>
<li>A <span class="math inline">\(p\)</span>-value <span class="math inline">\(p(X)\)</span> is a test statistic satisfying <span class="math inline">\(0 \leq p({\boldsymbol Y}) \leq 1\)</span> for every vector of observations <span class="math inline">\(\boldsymbol{Y}\)</span>.</li>
<li>Small values give evidence that <span class="math inline">\(H_1\)</span> is true.</li>
<li>In single hypothesis testing, if the <span class="math inline">\(p\)</span>-value is less than the chosen significance level (chosen upper limit for the probability of committing a type I error), then we reject the null hypothesis, <span class="math inline">\(H_0\)</span>.</li>
<li>The chosen significance level is often referred to as <span class="math inline">\(\alpha\)</span>.</li>
</ul>
<hr>
<p>A <span class="math inline">\(p\)</span>-value is <em>valid</em> if <span class="math display">\[ P(p(\boldsymbol{Y}) \leq \alpha) \leq \alpha \]</span> for all <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(0 \leq \alpha \leq 1\)</span>, whenever <span class="math inline">\(H_0\)</span> is true, that is, if the <span class="math inline">\(p\)</span>-value is valid, rejection on the basis of the <span class="math inline">\(p\)</span>-value ensures that the probability of type I error does not exceed <span class="math inline">\(\alpha\)</span>.</p>
<hr>
<p>An <em>exact</em> <span class="math inline">\(p\)</span>-value satisfies <span class="math display">\[P(p(\boldsymbol{Y}) \leq \alpha) = \alpha\]</span> for all <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(0 \leq \alpha \leq 1\)</span>.</p>
<ul>
<li>The exact <span class="math inline">\(p\)</span>-value is uniformly distributed when the null hypothesis is true.</li>
<li>This is a fact that is often misunderstood by users of <span class="math inline">\(p\)</span>-values.</li>
<li>The incorrect urban myth is that <span class="math inline">\(p\)</span>-values from true null hypotheses are close to one, when the correct fact is that all values in intervals of the same length are equally probable (which is a property of the uniform distribution).</li>
</ul>
<hr>
</section>
<section id="from-single-to-multiple-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="from-single-to-multiple-hypotheses">From single to multiple hypotheses</h2>
<p>In many situations we are not interested in testing only one hypothesis, but instead <span class="math inline">\(m\)</span> hypotheses.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Not reject <span class="math inline">\(H_0\)</span></th>
<th style="text-align: left;">Reject <span class="math inline">\(H_0\)</span></th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(H_0\)</span> true</td>
<td style="text-align: left;"><span class="math inline">\(U\)</span></td>
<td style="text-align: left;"><span class="math inline">\(V\)</span></td>
<td style="text-align: left;"><span class="math inline">\(m_0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(H_0\)</span> false</td>
<td style="text-align: left;"><span class="math inline">\(T\)</span></td>
<td style="text-align: left;"><span class="math inline">\(S\)</span></td>
<td style="text-align: left;"><span class="math inline">\(m - m_0\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;"><span class="math inline">\(m-R\)</span></td>
<td style="text-align: left;"><span class="math inline">\(R\)</span></td>
<td style="text-align: left;"><span class="math inline">\(m\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li>Out of the <span class="math inline">\(m\)</span> hypotheses tested, the (unknown) number of true null hypotheses is <span class="math inline">\(m_0\)</span>.</li>
<li><span class="math inline">\(V\)</span>: the number of type I errors (false positive findings) and</li>
<li><span class="math inline">\(T\)</span>: the number of type II errors (false negative findings).</li>
<li><span class="math inline">\(U\)</span>: the number of true null hypotheses that are not rejected and</li>
<li><span class="math inline">\(S\)</span>: the number of false null hypotheses that are rejected.</li>
<li><span class="math inline">\(R\)</span>: the number of hypoteses rejected for a specific cut-off</li>
</ul>
<p>Observe: only <span class="math inline">\(m\)</span> and <span class="math inline">\(R\)</span> is observed!</p>
<hr>
</section>
<section id="familywise-error-rate" class="level2">
<h2 class="anchored" data-anchor-id="familywise-error-rate">Familywise error rate</h2>
<p>The familywise error rate (FWER) is defined as <em>the probability of one or more false positive findings</em></p>
<p><span class="math display">\[ \text{FWER} = P(V &gt; 0) \]</span> The number of false positive findings <span class="math inline">\(V\)</span> is not known in a real life situation, but still we may find a cut-off on the <span class="math inline">\(p\)</span>-value, called <span class="math inline">\(\alpha_{\text loc}\)</span>, that gives an upper limit to (controls) the FWER.</p>
<hr>
<ul>
<li>Raw <span class="math inline">\(p\)</span>-value, <span class="math inline">\(p_j\)</span>, the lowest nominal level to reject the null hypothesis.<br>
</li>
<li>Adjusted <span class="math inline">\(p\)</span>-value, <span class="math inline">\(\tilde{p}_j\)</span>, is the nominal level of the multiple (simultaneous) test procedure at which <span class="math inline">\(H_{0j}, j=1,\ldots,m\)</span> is just rejected, given the values of all test statistics involved.</li>
</ul>
<p>The adjusted <span class="math inline">\(p\)</span>-values can be defined as <span class="math display">\[\tilde{p}_j = \text{inf}\{\alpha  \mid H_{0j}\text{ is rejected at FWER level } \alpha \}\]</span></p>
<p>In a multiple testing problem where all adjusted <span class="math inline">\(p\)</span>-value below <span class="math inline">\(\alpha\)</span> are rejected, the overall type I error rate (for example FWER) will be controlled at level <span class="math inline">\(\alpha\)</span>.</p>
<hr>
</section>
<section id="the-bonferroni-method-controls-the-fwer" class="level2">
<h2 class="anchored" data-anchor-id="the-bonferroni-method-controls-the-fwer">The Bonferroni method controls the FWER</h2>
<p>Single-step methods controls for multiple testing by estimating one local significance level, <span class="math inline">\(\alpha_{\text{loc}}\)</span>, which is used as a cut-off to detect significance for each individual test.</p>
<p>The Bonferroni method is valid for all types of dependence structures between the test statistics.</p>
<p>The local significance level is <span class="math display">\[\alpha_{\text loc}=\frac{\alpha}{m}\]</span></p>
<p>The adjusted <span class="math inline">\(p\)</span>-value is <span class="math display">\[ \tilde{p}_j =\min(1,m p_j)\]</span></p>
</section>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<p>This week the best way to spend the time is to work on the Data Analysis Project 1.</p>
<p>But, also good to study the R-code for the South African heart disease example, and make some changes.</p>
<p><strong>Smart:</strong> save this file as an .Rmd file and then run <code>purl(file.Rmd)</code> to produce a file with only the R-commands. (At the html-version you choose Code-Download Rmd on the top of the file).</p>
<ul>
<li>Change the CV criterion to auc and to class. Are there changes to what is the best choice for <span class="math inline">\(\lambda\)</span>?</li>
</ul>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-casi" class="csl-entry" role="doc-biblioentry">
Efron, Bradley, and Trevor Hastie. 2016. <em>Computer Age Statistical Inference - Algorithms, Evidence, and Data Science</em>. Cambridge University Press. <a href="https://hastie.su.domains/CASI/">https://hastie.su.domains/CASI/</a>.
</div>
<div id="ref-WNvW" class="csl-entry" role="doc-biblioentry">
Wieringen, Wessel N. van. 2021. <span>“Lecture Notes on Ridge Regression.”</span> <a href="https://arxiv.org/pdf/1509.09169v7.pdf">https://arxiv.org/pdf/1509.09169v7.pdf</a>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>