<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mette Langaas">
<meta name="dcterms.date" content="2023-01-27">

<title>MA8701 Advanced methods in statistical inference and learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="W3_files/libs/clipboard/clipboard.min.js"></script>
<script src="W3_files/libs/quarto-html/quarto.js"></script>
<script src="W3_files/libs/quarto-html/popper.min.js"></script>
<script src="W3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="W3_files/libs/quarto-html/anchor.min.js"></script>
<link href="W3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="W3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="W3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="W3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="W3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link active" data-scroll-target="#missing-data"><span class="toc-section-number">1</span>  Missing data</a>
  <ul class="collapse">
  <li><a href="#what-can-we-do" id="toc-what-can-we-do" class="nav-link" data-scroll-target="#what-can-we-do"><span class="toc-section-number">1.1</span>  What can we do?</a></li>
  <li><a href="#data-sets" id="toc-data-sets" class="nav-link" data-scroll-target="#data-sets"><span class="toc-section-number">1.2</span>  Data sets</a>
  <ul class="collapse">
  <li><a href="#nhanes" id="toc-nhanes" class="nav-link" data-scroll-target="#nhanes"><span class="toc-section-number">1.2.1</span>  NHANES</a></li>
  <li><a href="#airquality" id="toc-airquality" class="nav-link" data-scroll-target="#airquality"><span class="toc-section-number">1.2.2</span>  Airquality</a></li>
  <li><a href="#growth-of-dutch-boys" id="toc-growth-of-dutch-boys" class="nav-link" data-scroll-target="#growth-of-dutch-boys"><span class="toc-section-number">1.2.3</span>  Growth of Dutch boys</a></li>
  <li><a href="#pima-indians" id="toc-pima-indians" class="nav-link" data-scroll-target="#pima-indians"><span class="toc-section-number">1.2.4</span>  Pima indians</a></li>
  </ul></li>
  <li><a href="#group-discussion" id="toc-group-discussion" class="nav-link" data-scroll-target="#group-discussion"><span class="toc-section-number">1.3</span>  Group discussion</a></li>
  </ul></li>
  <li><a href="#notation-and-missing-mechanicms" id="toc-notation-and-missing-mechanicms" class="nav-link" data-scroll-target="#notation-and-missing-mechanicms"><span class="toc-section-number">2</span>  Notation and missing mechanicms</a>
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation"><span class="toc-section-number">2.1</span>  Notation</a></li>
  <li><a href="#missing-completely-at-random-mcar" id="toc-missing-completely-at-random-mcar" class="nav-link" data-scroll-target="#missing-completely-at-random-mcar"><span class="toc-section-number">2.2</span>  Missing completely at random (MCAR)</a></li>
  <li><a href="#missing-at-random-mar" id="toc-missing-at-random-mar" class="nav-link" data-scroll-target="#missing-at-random-mar"><span class="toc-section-number">2.3</span>  Missing at random (MAR)</a></li>
  <li><a href="#missing-not-at-random-mnar" id="toc-missing-not-at-random-mnar" class="nav-link" data-scroll-target="#missing-not-at-random-mnar"><span class="toc-section-number">2.4</span>  Missing not at random (MNAR)</a></li>
  <li><a href="#group-discussion-1" id="toc-group-discussion-1" class="nav-link" data-scroll-target="#group-discussion-1"><span class="toc-section-number">2.5</span>  Group discussion</a></li>
  <li><a href="#synthetic-example-with-missing-mechanisms" id="toc-synthetic-example-with-missing-mechanisms" class="nav-link" data-scroll-target="#synthetic-example-with-missing-mechanisms"><span class="toc-section-number">2.6</span>  Synthetic example with missing mechanisms</a></li>
  </ul></li>
  <li><a href="#popular-solutions-to-missing-data" id="toc-popular-solutions-to-missing-data" class="nav-link" data-scroll-target="#popular-solutions-to-missing-data"><span class="toc-section-number">3</span>  Popular solutions to missing data</a>
  <ul class="collapse">
  <li><a href="#use-an-analysis-method-that-handles-missing-data" id="toc-use-an-analysis-method-that-handles-missing-data" class="nav-link" data-scroll-target="#use-an-analysis-method-that-handles-missing-data"><span class="toc-section-number">3.1</span>  Use an analysis method that handles missing data</a></li>
  <li><a href="#complete-case-analysis" id="toc-complete-case-analysis" class="nav-link" data-scroll-target="#complete-case-analysis"><span class="toc-section-number">3.2</span>  Complete case analysis</a></li>
  <li><a href="#pairwise-deletion" id="toc-pairwise-deletion" class="nav-link" data-scroll-target="#pairwise-deletion"><span class="toc-section-number">3.3</span>  Pairwise deletion</a></li>
  <li><a href="#indicator-variable-method" id="toc-indicator-variable-method" class="nav-link" data-scroll-target="#indicator-variable-method"><span class="toc-section-number">3.4</span>  Indicator variable method</a></li>
  <li><a href="#single-imputation" id="toc-single-imputation" class="nav-link" data-scroll-target="#single-imputation"><span class="toc-section-number">3.5</span>  Single imputation</a>
  <ul class="collapse">
  <li><a href="#locf" id="toc-locf" class="nav-link" data-scroll-target="#locf"><span class="toc-section-number">3.5.1</span>  LOCF</a></li>
  <li><a href="#mean-imputation" id="toc-mean-imputation" class="nav-link" data-scroll-target="#mean-imputation"><span class="toc-section-number">3.5.2</span>  Mean imputation</a></li>
  </ul></li>
  <li><a href="#sec-regrimp" id="toc-sec-regrimp" class="nav-link" data-scroll-target="#sec-regrimp"><span class="toc-section-number">3.6</span>  Regression imputation</a></li>
  <li><a href="#sec-stochregrimp" id="toc-sec-stochregrimp" class="nav-link" data-scroll-target="#sec-stochregrimp"><span class="toc-section-number">3.7</span>  Stochastic regression imputation</a></li>
  <li><a href="#likelihood-approaches" id="toc-likelihood-approaches" class="nav-link" data-scroll-target="#likelihood-approaches"><span class="toc-section-number">3.8</span>  Likelihood approaches</a></li>
  <li><a href="#fully-bayesian-approaches" id="toc-fully-bayesian-approaches" class="nav-link" data-scroll-target="#fully-bayesian-approaches"><span class="toc-section-number">3.9</span>  Fully Bayesian approaches</a></li>
  <li><a href="#group-discussion-2" id="toc-group-discussion-2" class="nav-link" data-scroll-target="#group-discussion-2"><span class="toc-section-number">3.10</span>  Group discussion</a></li>
  </ul></li>
  <li><a href="#multiple-imputation" id="toc-multiple-imputation" class="nav-link" data-scroll-target="#multiple-imputation"><span class="toc-section-number">4</span>  Multiple imputation</a>
  <ul class="collapse">
  <li><a href="#short-historical-overview" id="toc-short-historical-overview" class="nav-link" data-scroll-target="#short-historical-overview"><span class="toc-section-number">4.1</span>  Short historical overview</a></li>
  <li><a href="#overview-of-the-steps-of-the-method" id="toc-overview-of-the-steps-of-the-method" class="nav-link" data-scroll-target="#overview-of-the-steps-of-the-method"><span class="toc-section-number">4.2</span>  Overview of the steps of the method</a></li>
  <li><a href="#analysis-model" id="toc-analysis-model" class="nav-link" data-scroll-target="#analysis-model"><span class="toc-section-number">4.3</span>  Analysis model</a>
  <ul class="collapse">
  <li><a href="#pima-indian-data" id="toc-pima-indian-data" class="nav-link" data-scroll-target="#pima-indian-data"><span class="toc-section-number">4.3.1</span>  Pima indian data</a></li>
  <li><a href="#other-examples" id="toc-other-examples" class="nav-link" data-scroll-target="#other-examples"><span class="toc-section-number">4.3.2</span>  Other examples</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#rubins-rules" id="toc-rubins-rules" class="nav-link" data-scroll-target="#rubins-rules"><span class="toc-section-number">5</span>  Rubin’s rules</a>
  <ul class="collapse">
  <li><a href="#algorithmic-view" id="toc-algorithmic-view" class="nav-link" data-scroll-target="#algorithmic-view"><span class="toc-section-number">5.1</span>  Algorithmic view</a>
  <ul class="collapse">
  <li><a href="#quantity-of-interest" id="toc-quantity-of-interest" class="nav-link" data-scroll-target="#quantity-of-interest"><span class="toc-section-number">5.1.1</span>  Quantity of interest</a></li>
  <li><a href="#estimator" id="toc-estimator" class="nav-link" data-scroll-target="#estimator"><span class="toc-section-number">5.1.2</span>  Estimator</a></li>
  <li><a href="#variance-estimator" id="toc-variance-estimator" class="nav-link" data-scroll-target="#variance-estimator"><span class="toc-section-number">5.1.3</span>  Variance estimator</a></li>
  <li><a href="#variance-ratios" id="toc-variance-ratios" class="nav-link" data-scroll-target="#variance-ratios"><span class="toc-section-number">5.1.4</span>  Variance ratios</a></li>
  <li><a href="#confidence-interval" id="toc-confidence-interval" class="nav-link" data-scroll-target="#confidence-interval"><span class="toc-section-number">5.1.5</span>  Confidence interval</a></li>
  <li><a href="#hypothesis-test" id="toc-hypothesis-test" class="nav-link" data-scroll-target="#hypothesis-test"><span class="toc-section-number">5.1.6</span>  Hypothesis test</a></li>
  <li><a href="#degrees-of-freedom" id="toc-degrees-of-freedom" class="nav-link" data-scroll-target="#degrees-of-freedom"><span class="toc-section-number">5.1.7</span>  Degrees of freedom</a></li>
  <li><a href="#rhanes-r-example" id="toc-rhanes-r-example" class="nav-link" data-scroll-target="#rhanes-r-example"><span class="toc-section-number">5.1.8</span>  RHANES R-example</a></li>
  <li><a href="#airquality-r-example" id="toc-airquality-r-example" class="nav-link" data-scroll-target="#airquality-r-example"><span class="toc-section-number">5.1.9</span>  Airquality R-example</a></li>
  <li><a href="#dutch-boys-r-example" id="toc-dutch-boys-r-example" class="nav-link" data-scroll-target="#dutch-boys-r-example"><span class="toc-section-number">5.1.10</span>  Dutch boys R-example</a></li>
  <li><a href="#pima-indians-r-example" id="toc-pima-indians-r-example" class="nav-link" data-scroll-target="#pima-indians-r-example"><span class="toc-section-number">5.1.11</span>  Pima indians R-example</a></li>
  </ul></li>
  <li><a href="#bayesian-view" id="toc-bayesian-view" class="nav-link" data-scroll-target="#bayesian-view"><span class="toc-section-number">5.2</span>  Bayesian view</a></li>
  <li><a href="#what-can-rubins-rules-be-used-on" id="toc-what-can-rubins-rules-be-used-on" class="nav-link" data-scroll-target="#what-can-rubins-rules-be-used-on"><span class="toc-section-number">5.3</span>  What can Rubin’s rules be used on?</a></li>
  </ul></li>
  <li><a href="#imputation-model-in-multiple-imputation" id="toc-imputation-model-in-multiple-imputation" class="nav-link" data-scroll-target="#imputation-model-in-multiple-imputation"><span class="toc-section-number">6</span>  Imputation model in multiple imputation</a>
  <ul class="collapse">
  <li><a href="#sec-mlrimp" id="toc-sec-mlrimp" class="nav-link" data-scroll-target="#sec-mlrimp"><span class="toc-section-number">6.1</span>  Multiple linear regression imputation model</a></li>
  <li><a href="#predictive-mean-matching" id="toc-predictive-mean-matching" class="nav-link" data-scroll-target="#predictive-mean-matching"><span class="toc-section-number">6.2</span>  Predictive mean matching</a></li>
  <li><a href="#missing-patterns" id="toc-missing-patterns" class="nav-link" data-scroll-target="#missing-patterns"><span class="toc-section-number">6.3</span>  Missing patterns</a></li>
  <li><a href="#joint-modelling" id="toc-joint-modelling" class="nav-link" data-scroll-target="#joint-modelling"><span class="toc-section-number">6.4</span>  Joint modelling</a></li>
  <li><a href="#fully-conditional-specification" id="toc-fully-conditional-specification" class="nav-link" data-scroll-target="#fully-conditional-specification"><span class="toc-section-number">6.5</span>  Fully conditional specification</a>
  <ul class="collapse">
  <li><a href="#notation-1" id="toc-notation-1" class="nav-link" data-scroll-target="#notation-1"><span class="toc-section-number">6.5.1</span>  Notation</a></li>
  <li><a href="#mice-algorithm" id="toc-mice-algorithm" class="nav-link" data-scroll-target="#mice-algorithm"><span class="toc-section-number">6.5.2</span>  MICE algorithm</a></li>
  <li><a href="#predictors-in-imputation-models" id="toc-predictors-in-imputation-models" class="nav-link" data-scroll-target="#predictors-in-imputation-models"><span class="toc-section-number">6.5.3</span>  Predictors in imputation models</a></li>
  </ul></li>
  <li><a href="#r-examples" id="toc-r-examples" class="nav-link" data-scroll-target="#r-examples"><span class="toc-section-number">6.6</span>  R examples</a>
  <ul class="collapse">
  <li><a href="#nhanes-1" id="toc-nhanes-1" class="nav-link" data-scroll-target="#nhanes-1"><span class="toc-section-number">6.6.1</span>  NHANES</a></li>
  <li><a href="#airquality-1" id="toc-airquality-1" class="nav-link" data-scroll-target="#airquality-1"><span class="toc-section-number">6.6.2</span>  Airquality</a></li>
  <li><a href="#pima-indians-1" id="toc-pima-indians-1" class="nav-link" data-scroll-target="#pima-indians-1"><span class="toc-section-number">6.6.3</span>  Pima indians</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-selection-and-assessment-when-using-multiple-imputation" id="toc-model-selection-and-assessment-when-using-multiple-imputation" class="nav-link" data-scroll-target="#model-selection-and-assessment-when-using-multiple-imputation"><span class="toc-section-number">7</span>  Model selection and assessment when using multiple imputation</a></li>
  <li><a href="#not-covered" id="toc-not-covered" class="nav-link" data-scroll-target="#not-covered"><span class="toc-section-number">8</span>  Not covered</a>
  <ul class="collapse">
  <li><a href="#ignorable-and-nonignorable" id="toc-ignorable-and-nonignorable" class="nav-link" data-scroll-target="#ignorable-and-nonignorable"><span class="toc-section-number">8.1</span>  Ignorable and nonignorable</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">9</span>  Exercises</a>
  <ul class="collapse">
  <li><a href="#links" id="toc-links" class="nav-link" data-scroll-target="#links"><span class="toc-section-number">9.1</span>  Links</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">10</span>  References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MA8701 Advanced methods in statistical inference and learning</h1>
<p class="subtitle lead">Week 3 (L5+L6): Missing data</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mette Langaas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 27, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>Course homepage: <a href="https://wiki.math.ntnu.no/ma8701/2023v/start" class="uri">https://wiki.math.ntnu.no/ma8701/2023v/start</a></p>
<p>Reading list:</p>
<ul>
<li>Handbook of missing data methodology: Chapter 12.1.2, 12.2, 12.3.3. Available for download (60 pages pr day) from Oria at NTNU (Choose EBSCOweb, then PDF full text and then just download chapter 12). <span class="citation" data-cites="missinghandbook2014">Molenberghs et al. (<a href="#ref-missinghandbook2014" role="doc-biblioref">2014</a>)</span></li>
<li><a href="https://stefvanbuuren.name/fimd/">Flexible imputation of missing data</a>: Chapters 1.1, 1.2, 1.3, 1.4, 2.2.4, 2.3.2 (similar to Handbook 12.2), 3.2.1, 3.2.2 (Algo 3.1), 3.4 (Algo 3.3), 4.5.1, 4.5.2. <span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span></li>
</ul>
<p><a href="https://github.com/mettelang/MA8701V2023/blob/main/Part1/W3overview.pdf">Graphical overview of the topics covered in W3</a></p>
<hr>
<section id="missing-data" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Missing data</h1>
<p>Many statistical analysis methods (for example regression) require the data (for analysis) to be <em>complete</em>. That is, for all data record (observations, rows) all the variable under study must be <em>observed</em>. But, in the real world this is not the case - some variables are missing for some observations (records, rows).</p>
<p>What are reasons for data to be missing?</p>
<hr>
<p>Some reasons (not exhaustive):</p>
<ul>
<li>nonresponse,</li>
<li>measurement error,</li>
<li>data entry errors,</li>
<li>data collection limitations,</li>
<li>sensitive or private information,</li>
<li>data cleaning.</li>
</ul>
<p>The missingness may be intentional (sampling) or unintentional (refusal, self-selection, skip questions, coding error).</p>
<hr>
<section id="what-can-we-do" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="what-can-we-do"><span class="header-section-number">1.1</span> What can we do?</h2>
<ul>
<li>delete all data records that are incomplete (have at least one missing value), and analyse these <em>complete cases</em></li>
<li>fill in a missing value with a “representative” value to get complete data aka <em>single imputation</em></li>
<li>as above, but make <em>m</em> datasets and analyse them all and then combine the results</li>
<li>use statistical methods that have built in mechanisms to handle missing data (more about this in Part 3 - hint: trees)</li>
<li>likelihood-based methods, where the missing data are modelled inside the model (not covered here)</li>
<li>if the reason (mechanism) for the missing data is known, build a statistical model that takes this into account (will not be covered here).</li>
</ul>
<hr>
<p>It is important to understand the underlying mechanism for the observations to be missing, so that we may treat the missing data appropriately.</p>
<p>If we do not treat missing data correctly, this may lead to</p>
<ul>
<li>wrong conclusions (the observed data might not be representative for the population under study),</li>
<li>there is a loss of power for statistical tests (or length of CIs) so that conclusions are weaker than if the data were complete, and</li>
<li>the statistical analyses may be complicated since standard methods (assuming no missing data) can´t be used.</li>
</ul>
<p>We first look at notation and then definitions of missing mechanisms.</p>
<hr>
</section>
<section id="data-sets" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data-sets"><span class="header-section-number">1.2</span> Data sets</h2>
<p>(Text provided by ChatGPT to “describe the NHANES data set in the mice R package.)</p>
<section id="nhanes" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="nhanes"><span class="header-section-number">1.2.1</span> NHANES</h3>
<p>The NHANES (National Health and Nutrition Examination Survey) data set is a collection of health and nutrition information collected by the National Center for Health Statistics (NCHS) of the Centers for Disease Control and Prevention (CDC). It is a nationally representative sample of the non-institutionalized civilian population of the United States. The data set includes information on demographic characteristics, health status, and health behaviors, as well as laboratory test results.</p>
<p>The data set is taken from Schafer, J.L. (1997). Analysis of Incomplete Multivariate Data. London: Chapman &amp; Hall. Table 6.14.</p>
<ul>
<li>nhanes/nhanes2: data frame with 25 observations of four variables (age (three age groups), bmi (kg/<span class="math inline">\(m^2\)</span>), hyp=hypertensive (1=no, 2=yes), chl=total serum cholesterol (mg/dL))</li>
<li>nhanes/nhanes2: the same data sets, but in nhanes all variables are treated as numerical</li>
</ul>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25  4</code></pre>
</div>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="airquality" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="airquality"><span class="header-section-number">1.2.2</span> Airquality</h3>
<p>R base datasets. Daily air quality measurements in New York, May to September 1973.</p>
<ul>
<li>Ozone numeric Ozone (ppb)</li>
<li>Solar.R numeric Solar R (lang)</li>
<li>Wind numeric Wind (mph)</li>
<li>Temp numeric Temperature (degrees F)</li>
<li>Month numeric Month (1–12)</li>
<li>Day numeric Day of month (1–31)</li>
</ul>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 153   6</code></pre>
</div>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="growth-of-dutch-boys" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="growth-of-dutch-boys"><span class="header-section-number">1.2.3</span> Growth of Dutch boys</h3>
<p>(mice R package)</p>
<p>The data set of growth of 748 Dutch boys. Nine measurements</p>
<ul>
<li>age: decimal age (0-21 years)</li>
<li>hgt: height (cm)</li>
<li>wgt: weight (kg)</li>
<li>bmi</li>
<li>hc: head circumference (cm)</li>
<li>gen: genital Tanner stage (G1-G5). Ordered factor</li>
<li>phb: pubic hear (Tanner P1-P6). Ordered factor</li>
<li>tv: testicular volume (ml)</li>
<li>reg: region (north, east, west, south, city). Factor</li>
</ul>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 748   9</code></pre>
</div>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="pima-indians" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="pima-indians"><span class="header-section-number">1.2.4</span> Pima indians</h3>
<p>(MASS R package)</p>
<p>We will use the classical data set of <em>diabetes</em> from a population of women of Pima Indian heritage in the US, available in the R <code>MASS</code> package. The following information is available for each woman:</p>
<ul>
<li>diabetes: <code>0</code>= not present, <code>1</code>= present (variable called type)</li>
<li>npreg: number of pregnancies</li>
<li>glu: plasma glucose concentration in an oral glucose tolerance test</li>
<li>bp: diastolic blood pressure (mmHg)</li>
<li>skin: triceps skin fold thickness (mm)</li>
<li>bmi: body mass index (weight in kg/(height in m)<span class="math inline">\(^2\)</span>)</li>
<li>ped: diabetes pedigree function.</li>
<li>age: age in years</li>
</ul>
<p>We will look at a data set (Pima.tr2) with a randomly selected set of 200 subjects (Pima.tr), plus 100 subjects with missing values in the explanatory variables.</p>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300   8</code></pre>
</div>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="group-discussion" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="group-discussion"><span class="header-section-number">1.3</span> Group discussion</h2>
<p>Make sure the three types of plots are understood!</p>
<ul>
<li>pairs plot</li>
<li>number of missing values</li>
<li>missing patterns</li>
</ul>
<hr>
</section>
</section>
<section id="notation-and-missing-mechanicms" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Notation and missing mechanicms</h1>
<section id="notation" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="notation"><span class="header-section-number">2.1</span> Notation</h2>
<p>We will use different letters for response and covariates, but often that is not done in other sources. (We will assume that missing values are only present in the covariates and not the response.)</p>
<p>By response we mean the response in the intended <em>analysis model</em> and ditto for the covariates. (We will later also talk about an <em>imputation model</em> but this is not connected to our notation here.)</p>
<hr>
<ul>
<li><span class="math inline">\({\mathbf y}\)</span>: response vector (no missing values)</li>
<li><span class="math inline">\({\mathbf X}\)</span>: the full covariate matrix</li>
<li><span class="math inline">\({\mathbf Z}=({\mathbf X},{\mathbf y})\)</span>: full responses and covariates</li>
<li><span class="math inline">\({\mathbf X}_{\text{obs}}\)</span>: the observed part of the covariate matrix</li>
<li><span class="math inline">\({\mathbf X}_{\text{mis}}\)</span>: the missing part of the covariate matrix</li>
<li><span class="math inline">\({\mathbf Z}_{\text{obs}}=({\mathbf X}_{\text{obs}},{\mathbf y})\)</span>: the observed responses and covariates</li>
<li><span class="math inline">\({\mathbf R}\)</span>: indicator matrix (0/1) for missingness/observability of <span class="math inline">\({\mathbf X}\)</span>, where <span class="math inline">\(1\)</span> denotes observed and <span class="math inline">\(0\)</span> denotes missing. (ELS 9.6 does the opposite, but that is not the common use.)</li>
<li><span class="math inline">\(\psi\)</span>: some parameter in the distribution of <span class="math inline">\({\mathbf R}\)</span>.</li>
</ul>
<p>We may use the indicator matrix together with the missing data vector and observed data vector to write out the full covariate matrix.</p>
<p>The missing data mechanism is characterized by the conditional distribution of <span class="math inline">\({\mathbf R}\)</span>; <span class="math display">\[P({\mathbf R} \mid {\mathbf Z},\psi)\]</span></p>
<hr>
</section>
<section id="missing-completely-at-random-mcar" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="missing-completely-at-random-mcar"><span class="header-section-number">2.2</span> Missing completely at random (MCAR)</h2>
<p><span class="math display">\[P({\mathbf R} \mid {\mathbf Z},\psi)=P({\mathbf R} \mid \psi)\]</span></p>
<ul>
<li>All observations have the same probability of being missing, and</li>
<li>the missing mechanism is not related to the data (not to observed or missing data).</li>
</ul>
<p>If observations with MCAR data are removed that should not bias the analyses (but the sample size will of cause be smaller), because the subset of complete observations should have the same distribution as the full data set.</p>
<hr>
<p>Examples:</p>
<ul>
<li>measure weight, and the scales run out of battery</li>
<li>similar mechanism to taking a random sample</li>
<li>a tube containing a blood sample of study subject is broken by accident and then the blood sample could not be analysed (a set of covariates are then missing)</li>
</ul>
<hr>
</section>
<section id="missing-at-random-mar" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="missing-at-random-mar"><span class="header-section-number">2.3</span> Missing at random (MAR)</h2>
<p><span class="math display">\[P({\mathbf R} \mid {\mathbf Z},\psi)=P({\mathbf R} \mid {\mathbf Z}_{\text obs},\psi)\]</span></p>
<ul>
<li>The probability of an entry to be missing depends (possibly) on observed data, but not on unobserved data.</li>
<li>Thus, all information about the missing data that we need to perform valid statistical analysis is found in the observed data (but maybe difficult to construct a model for this).</li>
<li>In a regression or classifiation setting this means that the missingness of a covariate may be dependent on the observed response.</li>
<li>Remark: not dependent on what could have been observed (i.e.&nbsp;what is not observed).</li>
</ul>
<hr>
<p><strong>Examples:</strong></p>
<ul>
<li>measure weight, and the scales have different missing proportions when being on a hard or soft surface</li>
<li>we have a group of healthy and sick individuals (this is the reponse), and for a proportion of the sick individuals the result of a diagnostic test is missing but for the healthy individuals there are no missing values</li>
</ul>
<p>Most methods for handling missing data require the data to be MAR. If you know that the missingness is at least MAR, then there exists tests to check if the data also is MCAR.</p>
<hr>
</section>
<section id="missing-not-at-random-mnar" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="missing-not-at-random-mnar"><span class="header-section-number">2.4</span> Missing not at random (MNAR)</h2>
<p>We have MNAR if we don´t have MAR or MCAR.</p>
<p>Then the missing mechanism could depend on what we could have measured (unobserved data) or other observed values (covariates or response that we are noe collecting). Statistical analyses can not be performed without modelling the underlying missing data mechanism.</p>
<hr>
<p><strong>Examples:</strong></p>
<ul>
<li>the scales give more often missing values for heavier objects than for lighter objects</li>
<li>a patient is too sick to perform some procedure that would show a high value of a measurement</li>
<li>when asking a subject for his/her income missing data are more likely to occur when the income level is high</li>
</ul>
<hr>
</section>
<section id="group-discussion-1" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="group-discussion-1"><span class="header-section-number">2.5</span> Group discussion</h2>
<p>So far in your study/work/other - you might have analysed a data set (maybe on Kaggle or in a course). Think of one such data set.</p>
<ul>
<li>Did this data set have missing values?</li>
<li>If yes, did you check if the observations were MCAR, MAR or MNAR?</li>
<li>What did you (or the teacher etc) do to handle the missing data?</li>
</ul>
<p>If you have not analysed missing data, instead look at the synthetic generation of data with different missing mechanisms below!</p>
<!-- Suggest to create simulation experiments to check the invalidity or validity of complete case analysis under the three types of missingness? -->
<hr>
</section>
<section id="synthetic-example-with-missing-mechanisms" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="synthetic-example-with-missing-mechanisms"><span class="header-section-number">2.6</span> Synthetic example with missing mechanisms</h2>
<p>Example from <span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Chapter 2.2.</p>
<p>A bivariate (0.5 correlation) normal response <span class="math inline">\((Y_1,Y_2)\)</span> is generated <span class="math inline">\(N=300\)</span>, and then data are removed from the second component <span class="math inline">\(Y_2\)</span>. This is done in three ways:</p>
<ul>
<li>MCAR: each observation <span class="math inline">\(Y_2\)</span> is missing with probability 0.5</li>
<li>MAR: each observation <span class="math inline">\(Y_2\)</span> is missing with probability dependent on <span class="math inline">\(Y_1\)</span></li>
<li>MNAR: each observation <span class="math inline">\(Y_2\)</span> is missing with probability dependent on <span class="math inline">\(Y_2\)</span>.</li>
</ul>
<p>The boxplots of observed and missing values are shown.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: true</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">80122</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Sigma =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>r2.mcar <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>r2.mar  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">logistic</span>(y[, <span class="dv">1</span>]))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>r2.mnar <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">logistic</span>(y[, <span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y[, <span class="dv">1</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> y[, <span class="dv">2</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(y,y,y)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">c</span>(r2.mcar,r2.mar,r2.mnar)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(r2, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Ymis"</span>,<span class="st">"Yobs"</span>))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>typ <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>,<span class="at">each=</span>n),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"MNAR"</span>,<span class="st">"MAR"</span>,<span class="st">"MCAR"</span>))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y1=</span>y3[,<span class="dv">1</span>],<span class="at">y2=</span>y3[,<span class="dv">2</span>],<span class="at">r2=</span>r2,<span class="at">typ=</span>typ)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">trellis.par.set</span>(<span class="at">box.rectangle=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="fu">mdc</span>(<span class="dv">2</span>),<span class="fu">mdc</span>(<span class="dv">1</span>)),<span class="at">lwd=</span><span class="fl">1.2</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">trellis.par.set</span>(<span class="at">box.umbrella=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="fu">mdc</span>(<span class="dv">2</span>),<span class="fu">mdc</span>(<span class="dv">1</span>)),<span class="at">lwd=</span><span class="fl">1.2</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">trellis.par.set</span>(<span class="at">plot.symbol=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">mdc</span>(<span class="dv">3</span>),<span class="at">lwd=</span><span class="dv">1</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>tp <span class="ot">&lt;-</span> <span class="fu">bwplot</span>(r2<span class="sc">~</span>y2<span class="sc">|</span>typ, <span class="at">data=</span>d,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">horizontal=</span><span class="cn">TRUE</span>, <span class="at">layout=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab=</span><span class="fu">expression</span>(Y[<span class="dv">2</span>]),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="fu">c</span>(<span class="fu">mdc</span>(<span class="dv">2</span>),<span class="fu">mdc</span>(<span class="dv">1</span>)),<span class="at">strip=</span><span class="cn">FALSE</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.left =</span> <span class="fu">strip.custom</span>(<span class="at">bg=</span><span class="st">"grey95"</span>))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="popular-solutions-to-missing-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Popular solutions to missing data</h1>
<!-- Here: If there are missing values in the responses, we start by removing observations with missing responses. -->
<section id="use-an-analysis-method-that-handles-missing-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="use-an-analysis-method-that-handles-missing-data"><span class="header-section-number">3.1</span> Use an analysis method that handles missing data</h2>
<p>One such method is the CART classification and regression tree! How is it done? More in Part 3.</p>
<hr>
</section>
<section id="complete-case-analysis" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="complete-case-analysis"><span class="header-section-number">3.2</span> Complete case analysis</h2>
<p>Discard all observations containing missing values. This is also called “listwise deletion”.</p>
<ul>
<li>Wasteful, but will give valid inference for MCAR.</li>
<li>If the missing is MAR a complete case analysis may lead to bias. In a regression setting if a missing covariate is dependent on the response, then parameter estimates may become biased.</li>
</ul>
<p>Let each variable have a probability for missing values of 0.05, then for 20 variables the probability of an observation to be complete is <span class="math inline">\((1 − 0.05)^20 = 0.36\)</span>, for 50 variables <span class="math inline">\(0.08\)</span>. Not many observations left with complete case analysis. Of cause some variables may have more missing than others, and removing those variables first may of cause lead to less observations that are incomplete</p>
<hr>
</section>
<section id="pairwise-deletion" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="pairwise-deletion"><span class="header-section-number">3.3</span> Pairwise deletion</h2>
<p>For example when calculating a correlation matrix only complete pairs may enter in the calculation. This is also called “available-case analysis”. A covariance matrix constructed from pairwise deletion may not be positive definite.</p>
<hr>
</section>
<section id="indicator-variable-method" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="indicator-variable-method"><span class="header-section-number">3.4</span> Indicator variable method</h2>
<p>Assume we have regression setting with missing values only in one of the covariates. The indicator method generates a new covariate as a missing indicator, and replaces the missing values in the original covariate with 0s.</p>
<p><span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> (Chapter 1.3.7) says that it can be shown that biased estimates of regression parameters can occur also under MCAR. However the method works in particular situation. Which situations this is I (Mette) have not looked into. Would be interesting to know.</p>
<p>A version of this method is used in machine learning. If the covariate is a categorical covariate then an extra category is created for the missing data. Here more information would be of interest to include!</p>
<hr>
</section>
<section id="single-imputation" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="single-imputation"><span class="header-section-number">3.5</span> Single imputation</h2>
<p>here each missing value is imputed (filled in) once by some “estimate” or “prediction” and the data set is then assumed to be complete and standard statistical methods are used.</p>
<hr>
<p><strong>Problems with single imputation:</strong> Standard errors may be underestimated giving too narrow CIs and too low <span class="math inline">\(p\)</span>-values. Why: the imputed data are treated as fixed (known) values.</p>
<p>Versions of single imputation:</p>
<section id="locf" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="locf"><span class="header-section-number">3.5.1</span> LOCF</h3>
<p>Last observation carried forward. Time series etc. Not recommended, unless there is a reason to believe that nothing has changed.</p>
<hr>
</section>
<section id="mean-imputation" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="mean-imputation"><span class="header-section-number">3.5.2</span> Mean imputation</h3>
<p>Replace the missing value with the mean of the covariate over all samples.</p>
<p>This will decrease the variability in the data.</p>
<p>“Common solution” within machine learning, but not so common in statistics. Will not give valid inference (but unbiased estimate for the mean).</p>
<p>Example below (airquality data): Blue indicates the observed data, red indicates the imputed values.</p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mice"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"mi.hist.R"</span>) <span class="co">#downloaded from https://github.com/stefvanbuuren/fimdbook/blob/master/R/</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(airquality, <span class="at">method =</span> <span class="st">"mean"</span>, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">maxit =</span> <span class="dv">1</span>,<span class="at">print=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>lwd <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Yobs <span class="ot">&lt;-</span> airquality[,<span class="st">"Ozone"</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>Yimp <span class="ot">&lt;-</span> data[,<span class="st">"Ozone"</span>]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mi.hist</span>(Yimp, Yobs,<span class="at">b=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">200</span>,<span class="dv">10</span>),<span class="at">type=</span><span class="st">"continuous"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">gray=</span>F,<span class="at">lwd =</span> lwd,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.lwd=</span><span class="fl">1.5</span>, <span class="at">mis.lwd=</span><span class="fl">1.5</span>, <span class="at">imp.lwd=</span><span class="fl">1.5</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.col=</span><span class="fu">mdc</span>(<span class="dv">4</span>), <span class="at">mis.col=</span><span class="fu">mdc</span>(<span class="dv">5</span>), <span class="at">imp.col=</span><span class="st">"transparent"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">mlt=</span><span class="fl">0.08</span>,<span class="at">main=</span><span class="st">""</span>,<span class="at">xlab=</span><span class="st">"Ozone (ppb)"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data[<span class="fu">cci</span>(imp),<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>],<span class="at">col=</span><span class="fu">mdc</span>(<span class="dv">1</span>), <span class="at">lwd=</span><span class="fl">1.5</span>,<span class="at">ylab=</span><span class="st">"Ozone (ppb)"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Solar Radiation (lang)"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">170</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(data[<span class="fu">ici</span>(imp),<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>],<span class="at">col=</span><span class="fu">mdc</span>(<span class="dv">2</span>),<span class="at">lwd=</span><span class="fl">1.5</span>,<span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">lwd =</span> lwd)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">lwd =</span> lwd, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Quality of mean imputation:</strong> mean unbiased under MCAR, and regression weights or correlations not. Standard errors too small.</p>
<hr>
</section>
</section>
<section id="sec-regrimp" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-regrimp"><span class="header-section-number">3.6</span> Regression imputation</h2>
<p>Can we use the relationship between the variables to provide a more “sensible” value than the overall mean?</p>
<p>We look at the pair of Solar (here assume to not have missing values) and Ozone (with missing values). We fit a simple linear regression with Solar as covariate and Ozone as response using only the complete cases.</p>
<p>Then we turn to observations where Ozone is missing but Solar is observed, and use the regression model to predict Ozone as a function of Solar.</p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Solar.R, <span class="at">data =</span> airquality)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># by default complete case performed</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">ic</span>(airquality))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mice::ic=select the incomplete cases</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stef</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ----plotregimp, duo = TRUE, echo=FALSE, fig.width=4.5, fig.height=2.25----</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>lwd <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>Yobs <span class="ot">&lt;-</span> airquality[,<span class="st">"Ozone"</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>Yimp <span class="ot">&lt;-</span> Yobs</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>Yimp[<span class="fu">ici</span>(airquality)] <span class="ot">&lt;-</span> pred</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">cci</span>(airquality<span class="sc">$</span>Solar.R)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Ozone=</span>Yimp, <span class="at">Solar.R=</span>airquality<span class="sc">$</span>Solar.R)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mi.hist</span>(Yimp[ss], Yobs[ss],<span class="at">b=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">200</span>,<span class="dv">10</span>),<span class="at">type=</span><span class="st">"continuous"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">gray=</span>F, <span class="at">lwd =</span> lwd,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.lwd=</span><span class="fl">1.5</span>, <span class="at">mis.lwd=</span><span class="fl">1.5</span>, <span class="at">imp.lwd=</span><span class="fl">1.5</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.col=</span><span class="fu">mdc</span>(<span class="dv">4</span>),<span class="at">mis.col=</span><span class="fu">mdc</span>(<span class="dv">5</span>), <span class="at">imp.col=</span><span class="st">"transparent"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">mlt=</span><span class="fl">0.08</span>,<span class="at">main=</span><span class="st">""</span>,<span class="at">xlab=</span><span class="st">"Ozone (ppb)"</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data[<span class="fu">cci</span>(imp),<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>],<span class="at">col=</span><span class="fu">mdc</span>(<span class="dv">1</span>),<span class="at">lwd=</span><span class="fl">1.5</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Ozone (ppb)"</span>, <span class="at">xlab=</span><span class="st">"Solar Radiation (lang)"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">170</span>), <span class="at">axes =</span> <span class="cn">FALSE</span>,<span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(data[<span class="fu">ici</span>(imp),<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>],<span class="at">col=</span><span class="fu">mdc</span>(<span class="dv">2</span>),<span class="at">lwd=</span><span class="fl">1.5</span>,<span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">lwd =</span> lwd)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">lwd =</span> lwd, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Same plot is produced with the code below, but now using the built in R mice function with method=“norm.predict”.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ----regimp2, eval = FALSE-----------------------------------------------</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> airquality[, <span class="fu">c</span>(<span class="st">"Ozone"</span>, <span class="st">"Solar.R"</span>)]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(data, <span class="at">method =</span> <span class="st">"norm.predict"</span>, <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">m =</span> <span class="dv">1</span>, <span class="at">print =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(imp, Ozone <span class="sc">~</span> Solar.R,<span class="at">pch=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Quality of regression imputation:</strong> mean and regression weights are unbiased under MAR. Correlation is not. The imputed red dots have correlation 1 (linear relationship). Standard errors too small.</p>
<hr>
</section>
<section id="sec-stochregrimp" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="sec-stochregrimp"><span class="header-section-number">3.7</span> Stochastic regression imputation</h2>
<p>This is very similar to the regression imputation, but i the prediction phase we do not predict the mean, but instead start with this predicted mean and then add a random draw from the residuals of the model fit.</p>
<p>This may create observations outside the range of the data. See negatively predicted Ozone in the example below.</p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: true</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ----sri-----------------------------------------------------------------</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> airquality[, <span class="fu">c</span>(<span class="st">"Ozone"</span>, <span class="st">"Solar.R"</span>)]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(data, <span class="at">method =</span> <span class="st">"norm.nob"</span>, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">maxit =</span> <span class="dv">1</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">1</span>, <span class="at">print =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: true</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|warnings: false</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#|error: false</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ----plotsri, duo = TRUE, echo=FALSE, fig.width=4.5, fig.height=2.25-----</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>lwd <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>Yobs <span class="ot">&lt;-</span> airquality[, <span class="st">"Ozone"</span>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>Yimp <span class="ot">&lt;-</span> data[, <span class="st">"Ozone"</span>]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mi.hist</span>(Yimp, Yobs,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">b =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="dv">200</span>, <span class="dv">10</span>), <span class="at">type =</span> <span class="st">"continuous"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">gray =</span> <span class="cn">FALSE</span>, <span class="at">lwd =</span> lwd,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.lwd =</span> <span class="fl">1.5</span>, <span class="at">mis.lwd =</span> <span class="fl">1.5</span>, <span class="at">imp.lwd =</span> <span class="fl">1.5</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs.col =</span> <span class="fu">mdc</span>(<span class="dv">4</span>),<span class="at">mis.col =</span> <span class="fu">mdc</span>(<span class="dv">5</span>), <span class="at">imp.col =</span> <span class="st">"transparent"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">mlt =</span> <span class="fl">0.08</span>, <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"Ozone (ppb)"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data[<span class="fu">cci</span>(imp), <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>], <span class="at">col =</span> <span class="fu">mdc</span>(<span class="dv">1</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">ylab =</span> <span class="st">"Ozone (ppb)"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Solar Radiation (lang)"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">170</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>,<span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(data[<span class="fu">ici</span>(imp), <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>], <span class="at">col =</span> <span class="fu">mdc</span>(<span class="dv">2</span>), <span class="at">lwd =</span> <span class="fl">1.5</span>,<span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">lwd =</span> lwd)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">lwd =</span> lwd, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Quality of stochastic regression imputation:</strong> mean, regression weights and correlations are unbiased under MAR. Standard errors too small.</p>
<hr>
</section>
<section id="likelihood-approaches" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="likelihood-approaches"><span class="header-section-number">3.8</span> Likelihood approaches</h2>
<p>(Not included in 2023)</p>
<p>For example</p>
<ul>
<li><a href="https://onlinelibrary.wiley.com/doi/10.1002/sim.7914">Bjørnland et al.&nbsp;(2018) Powerful extreme phenotype sampling designs and score tests for genetic association studies</a></li>
<li>EM-algorithm from TMA4300 Computational statistics</li>
</ul>
</section>
<section id="fully-bayesian-approaches" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="fully-bayesian-approaches"><span class="header-section-number">3.9</span> Fully Bayesian approaches</h2>
<p>Sadly, not covered here.</p>
<hr>
</section>
<section id="group-discussion-2" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="group-discussion-2"><span class="header-section-number">3.10</span> Group discussion</h2>
<p>Of the single imputation methods the stochastic regression imputation method appears to be the best. Do you see why? Would you think of possible improvements to this method?</p>
<hr>
</section>
</section>
<section id="multiple-imputation" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Multiple imputation</h1>
<section id="short-historical-overview" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="short-historical-overview"><span class="header-section-number">4.1</span> Short historical overview</h2>
<p>Historically multiple imputation dates back to Donald B. Rubin in the 1970´s. The idea is that multiple data set (multiple imputations) will reflect the uncertainty in the missing data. To construct the <span class="math inline">\(m\)</span> data sets theory from Bayesian statistics is used, but executed within the frequentist framework. Originally <span class="math inline">\(m=5\)</span> imputed data sets was the rule of thumb.</p>
<p>The method did not become a standard tool until 2005 (according to <span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span>, 2.1.2), but now in 2023 it is widely used in statistics and has replaced version of single imputation. However, multiple imputation is not main stream in machine learning.</p>
<hr>
</section>
<section id="overview-of-the-steps-of-the-method" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="overview-of-the-steps-of-the-method"><span class="header-section-number">4.2</span> Overview of the steps of the method</h2>
<ul>
<li>Devise a method to construct the distribution of each covariate (that can be missing) based on other covariates (often a regression method). This is the Imputation model.</li>
<li>Sample multiple observation for each missing value, and get <span class="math inline">\(m\)</span> complete dataset.</li>
<li>Analyse all <span class="math inline">\(m\)</span> dataset as complete datasets with ordinary statistical methods (using the Analysis model)</li>
<li>and weigh the results together using something called Rubin´s rules.</li>
</ul>
<p>The method gives powerful and valid inference for MAR and MCAR, and “solved” the problem with the “too small standard errors” for the single imputation methods.</p>
<p><span class="citation" data-cites="lydersen_multippel">Lydersen (<a href="#ref-lydersen_multippel" role="doc-biblioref">2022</a>)</span> gives a nice overview for medical doctors.</p>
<hr>
<p>Schematic for multiple imputation from Marthe Bøe Ludvigsen project thesis.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"MIflowMBL.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="MIflowMBL.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>We start with explaining the method for combining estimates with uncertainties from the <span class="math inline">\(m\)</span> complete data analyses (using the planned Analysis model), and wait til the end with the Imputation model!</p>
</section>
<section id="analysis-model" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="analysis-model"><span class="header-section-number">4.3</span> Analysis model</h2>
<section id="pima-indian-data" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="pima-indian-data"><span class="header-section-number">4.3.1</span> Pima indian data</h3>
<p>In the Pima indian data set the aim is to model the connection between the presence/absence of diabetes (binary response) and the other measured variable.</p>
<p>This is the Analysis model for the Pima indian example.</p>
</section>
<section id="other-examples" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="other-examples"><span class="header-section-number">4.3.2</span> Other examples</h3>
<p>In other cases we might have a linear regression model.</p>
<p>In class we will look at an analysis by Marthe Bøe Ludvigsen for possible risk factors for predicting low and high levels of the suicial crisis syndrome. This is a collaboration with Terje Torgersen and Linde Melby at St Olavs Hospital/NTNU.</p>
</section>
</section>
</section>
<section id="rubins-rules" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Rubin’s rules</h1>
<section id="algorithmic-view" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="algorithmic-view"><span class="header-section-number">5.1</span> Algorithmic view</h2>
<p>Fist we look at formulas for our quantities of interest, and next the Bayesian motivation for the formulas.</p>
<section id="quantity-of-interest" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="quantity-of-interest"><span class="header-section-number">5.1.1</span> Quantity of interest</h3>
<p>We denote our quantity (parameter) of interest by <span class="math inline">\(\mathbf{Q}\)</span>, and assume this to be a <span class="math inline">\(k\times 1\)</span> column vector.</p>
<p><strong>Example 1:</strong> Multiple linear regression</p>
<p><span class="math display">\[\begin{align}
\mathbf{Y} = \mathbf{X}{\boldsymbol \beta} + \boldsymbol{\varepsilon}
\end{align}\]</span> where <span class="math inline">\(\boldsymbol{\varepsilon}\sim N(\mathbf{0},\sigma^2\mathbf{I})\)</span>.</p>
<p>Here <span class="math inline">\(\mathbf{Q}=\boldsymbol{\beta}\)</span>.</p>
<p><strong>Example 2:</strong> Logistic regression</p>
<p>Again <span class="math inline">\(\mathbf{Q}=\boldsymbol{\beta}\)</span>.</p>
<p><span class="math inline">\(\mathbf{Q}\)</span> can also be a vector of population means or population variances. It may not depend on a particular sample, so it cannot be a sample mean or a <span class="math inline">\(p\)</span>-value.</p>
<hr>
</section>
<section id="estimator" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="estimator"><span class="header-section-number">5.1.2</span> Estimator</h3>
<p>If we have a complete data set - our imputed data set number <span class="math inline">\(l\)</span>. we might get <span class="math inline">\(\hat{\mathbf{Q}}_l\)</span> as our estimate. This takes into account the variablity in the complete data set.</p>
<p><strong>Example 1:</strong> <span class="math inline">\(\hat{\boldsymbol{\beta}}=({\mathbf X}^T{\mathbf X})^{-1} {\mathbf X}^T {\mathbf Y}\)</span></p>
<p><strong>Example 2:</strong> Maximizing the binary likelihood for the logistic regression (GLM with logit link) does not give a closed form solution, but a numerical value for <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> is found using Newton-Raphson.</p>
<hr>
<p>We also want to take into account the fact that we have <span class="math inline">\(m\)</span> complete data sets (multiple imputations). Let the pooled estimate be <span class="math display">\[ \overline{\mathbf{Q}}=\frac{1}{m}\sum_{l=1}^m \hat{\mathbf{Q}}_l\]</span></p>
<p>This is based on each of the estimated <span class="math inline">\(\mathbf{Q}\)</span> in our <span class="math inline">\(m\)</span> imputed data set.</p>
<p>Next: uncertainty in <span class="math inline">\(\hat{\mathbf{Q}}_l\)</span> and <span class="math inline">\(\overline{\mathbf{Q}}\)</span>.</p>
<hr>
</section>
<section id="variance-estimator" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="variance-estimator"><span class="header-section-number">5.1.3</span> Variance estimator</h3>
<p>What is the variance of the new estimator <span class="math inline">\(\overline{\mathbf{Q}}\)</span>?</p>
<p>Let <span class="math inline">\(\overline{\mathbf{U}}_l\)</span> be the estimated covariance of <span class="math inline">\(\hat{\mathbf{Q}}_l\)</span>.</p>
<p><strong>Example 1:</strong> <span class="math inline">\(\widehat{\text{Cov}}(\hat{\boldsymbol{\beta}})=({\mathbf X}^T{\mathbf X})^{-1} \hat{\sigma}^2\)</span></p>
<p><strong>Example 2:</strong> <span class="math inline">\(\widehat{\text{Cov}}(\hat{\boldsymbol{\beta}})\approx I^{-1}(\hat{\boldsymbol{\beta}})\)</span> the inverse of the estimated Fisher information matrix.</p>
<hr>
<ol type="1">
<li><p>Within-imputation variance <span class="math display">\[\overline{\mathbf U}=\frac{1}{m}\sum_{l=1}^m \overline{\mathbf{U}}_l\]</span></p></li>
<li><p>Between-imputation variance <span class="math display">\[\mathbf B=\frac{1}{m-1}\sum_{l=1}^m (\hat{\mathbf{Q}}_l-\overline{\mathbf{Q}})(\hat{\mathbf{Q}}_l-\overline{\mathbf{Q}})^T\]</span></p></li>
</ol>
<ul>
<li><span class="math inline">\(\overline{\mathbf U}\)</span>: large if the number of observations <span class="math inline">\(N\)</span> is small</li>
<li><span class="math inline">\({\mathbf B}\)</span>: large if many missing observations</li>
</ul>
<hr>
<ol start="3" type="1">
<li>Total variance of <span class="math inline">\(\overline{\mathbf{Q}}\)</span></li>
</ol>
<p><span class="math display">\[\mathbf{T}=\overline{\mathbf U}+\mathbf{B}+\frac{\mathbf{B}}{m}=\overline{\mathbf U}+(1+\frac{1}{m})\mathbf{B}\]</span></p>
<ul>
<li>First term: variance due to taking a sample and not examining the entire population (our conventional variance of estimator.</li>
<li>Second term: extra variance due to missing values in the samples</li>
<li>The last term is the simulation error: added because <span class="math inline">\(\overline{\mathbf{Q}}\)</span> is based on finite <span class="math inline">\(m\)</span></li>
</ul>
<hr>
</section>
<section id="variance-ratios" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="variance-ratios"><span class="header-section-number">5.1.4</span> Variance ratios</h3>
<p>for scalar <span class="math inline">\(Q\)</span> (for example one of the regression coefficients)</p>
<p>Proportion of variation “attributable” to the missing data <span class="math display">\[ \lambda=\frac{B+B/m}{T}\]</span> Relative increase in variance due to missingness</p>
<p><span class="math display">\[r=\frac{B+B/m}{\overline{U}}\]</span></p>
<p>Relation:</p>
<p><span class="math display">\[ r=\frac{\lambda}{1-\lambda}\]</span></p>
<hr>
</section>
<section id="confidence-interval" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="confidence-interval"><span class="header-section-number">5.1.5</span> Confidence interval</h3>
<p>Common assumption: <span class="math inline">\(\overline{\mathbf{Q}}\)</span> is multivariate normal with mean <span class="math inline">\(\mathbf{Q}\)</span> and estimated covariance matrix <span class="math inline">\(\mathbf{T}\)</span>.</p>
<p>We look at one component of <span class="math inline">\(\mathbf{Q}\)</span>, denoted <span class="math inline">\(Q\)</span> (maybe regression parameter for a specific covariate), antd <span class="math inline">\(T\)</span> is the appropriate component of the total variance estimate.</p>
<p><span class="math inline">\((1-\alpha)100\%\)</span> confidence interval for <span class="math inline">\(Q\)</span>:</p>
<p><span class="math display">\[\overline{Q} \pm t_{\nu,1-\alpha/2}\sqrt{T}\]</span></p>
<p>where <span class="math inline">\(t_{\nu,1-\alpha/2}\)</span> is the value in the <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(\nu\)</span> degrees of freedom with area <span class="math inline">\(1-\alpha/2\)</span> to the left.</p>
<p>What is <span class="math inline">\(\nu\)</span>?</p>
<hr>
</section>
<section id="hypothesis-test" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="hypothesis-test"><span class="header-section-number">5.1.6</span> Hypothesis test</h3>
<p>We want to test <span class="math inline">\(H_0: Q=Q_0\)</span> vs <span class="math inline">\(H_1: Q\neq Q_0\)</span>. The <span class="math inline">\(p\)</span>-value of the test can be calculated as <span class="math display">\[ P(F_{1,\nu} &gt; \frac{(\overline{Q}-Q_0)}{T})\]</span></p>
<p>where <span class="math inline">\(F_{1,\nu}\)</span> is a random variable following a Fisher distribution with <span class="math inline">\(1\)</span> and <span class="math inline">\(\nu\)</span> degrees of freedom.</p>
<hr>
</section>
<section id="degrees-of-freedom" class="level3" data-number="5.1.7">
<h3 data-number="5.1.7" class="anchored" data-anchor-id="degrees-of-freedom"><span class="header-section-number">5.1.7</span> Degrees of freedom</h3>
<p><span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Chapter 2.3.6 attributed this first solution to Rubind in 1987.</p>
<p><span class="math display">\[\nu_{\text{old}}=(m-1)(1+\frac{1}{r^2})=\frac{m-1}{\lambda^2}\]</span></p>
<p>If <span class="math inline">\(\lambda=1\)</span> then all variability is due to the missingness and then <span class="math inline">\(\nu_{\text{old}}=m-1\)</span>.</p>
<p>If <span class="math inline">\(\lambda\rightarrow 0\)</span> then <span class="math inline">\(\nu_{\text{old}}\rightarrow \infty\)</span> (normal distribution instead of t, chisq instead of F).</p>
<hr>
<p><span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Chapter 2.3.6: A newer solution is due to Barnard and Rubin in 1999.</p>
<p><span class="math display">\[\nu_{\text{com}}=n-k\]</span></p>
<p><span class="math display">\[\nu_{\text{obs}}=\frac{\nu_{\text{com}}+1}{\nu_{\text{com}}+3} \nu_{\text{com}}(1-\lambda)\]</span> <span class="math display">\[\nu=\frac{\nu_{\text{old}}\nu_{\text{obs}}}{\nu_\text{old}+\nu_{\text{obs}}}\]</span></p>
<hr>
</section>
<section id="rhanes-r-example" class="level3" data-number="5.1.8">
<h3 data-number="5.1.8" class="anchored" data-anchor-id="rhanes-r-example"><span class="header-section-number">5.1.8</span> RHANES R-example</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(nhanes, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(bmi <span class="sc">~</span> age))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 10 
         term  m  estimate      ubar         b        t dfcom       df
1 (Intercept) 10 29.621111 3.4810048 1.4312926 5.055427    23 12.62920
2         age 10 -1.802222 0.9257992 0.2759968 1.229396    23 14.42517
        riv    lambda       fmi
1 0.4522895 0.3114320 0.3995451
2 0.3279291 0.2469478 0.3333805</code></pre>
</div>
</div>
<p>Identify the the different estimates defined above!</p>
<ul>
<li>df is the <span class="math inline">\(\nu\)</span> above (Barnard-Rubin),</li>
<li>while dfcom is the <span class="math inline">\(\nu_{\text{com}}\)</span>.</li>
<li><span class="math inline">\(r\)</span>: proportion of variance to due to missingness<br>
</li>
<li><span class="math inline">\(\lambda\)</span>: fraction of missing information<br>
</li>
<li><span class="math inline">\(\gamma\)</span>: fraction of information about <span class="math inline">\(Q\)</span> due to missingness (not given formula)</li>
</ul>
<hr>
</section>
<section id="airquality-r-example" class="level3" data-number="5.1.9">
<h3 data-number="5.1.9" class="anchored" data-anchor-id="airquality-r-example"><span class="header-section-number">5.1.9</span> Airquality R-example</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(airquality, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(Wind <span class="sc">~</span> Ozone))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 10 
         term  m    estimate         ubar            b            t dfcom
1 (Intercept) 10 12.59824641 1.520270e-01 2.593886e-02 1.805597e-01   151
2       Ozone 10 -0.06245227 5.416219e-05 1.599145e-05 7.175278e-05   151
        df       riv    lambda       fmi
1 93.07909 0.1876821 0.1580238 0.1755506
2 64.23966 0.3247762 0.2451555 0.2676079</code></pre>
</div>
</div>
<hr>
</section>
<section id="dutch-boys-r-example" class="level3" data-number="5.1.10">
<h3 data-number="5.1.10" class="anchored" data-anchor-id="dutch-boys-r-example"><span class="header-section-number">5.1.10</span> Dutch boys R-example</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmice</span>(boys, <span class="fu">aes</span>(age, wgt)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(boys, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(wgt <span class="sc">~</span> age))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 10 
         term  m estimate        ubar            b           t dfcom       df
1 (Intercept) 10 4.275250 0.242037333 2.812862e-04 0.242346747   746 742.9581
2         age 10 3.587684 0.001842701 5.689418e-06 0.001848959   746 740.7905
          riv      lambda         fmi
1 0.001278376 0.001276744 0.003954437
2 0.003396298 0.003384802 0.006064630</code></pre>
</div>
</div>
<hr>
</section>
<section id="pima-indians-r-example" class="level3" data-number="5.1.11">
<h3 data-number="5.1.11" class="anchored" data-anchor-id="pima-indians-r-example"><span class="header-section-number">5.1.11</span> Pima indians R-example</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(Pima.tr2, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">glm</span>(type <span class="sc">~</span> bmi,<span class="at">family =</span> <span class="st">"binomial"</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 10 
         term  m    estimate         ubar            b            t dfcom
1 (Intercept) 10 -3.84045347 0.4798495316 6.914875e-03 0.4874558946   298
2         bmi 10  0.09929536 0.0004251267 6.134841e-06 0.0004318751   298
        df        riv     lambda        fmi
1 289.1214 0.01585156 0.01560421 0.02234384
2 289.1090 0.01587368 0.01562564 0.02236542</code></pre>
</div>
</div>
<p>Identify the the different estimates defined above!</p>
<p>df is the <span class="math inline">\(\nu\)</span> above (Barnard-Rubin), while dfcom is the <span class="math inline">\(\nu_{\text{com}}\)</span>.</p>
<hr>
</section>
</section>
<section id="bayesian-view" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="bayesian-view"><span class="header-section-number">5.2</span> Bayesian view</h2>
<p>Presented in writing in class, see <a href="https://github.com/mettelang/MA8701V2023/blob/main/Part1/L6beamer20230127.pdf">classnotes lecture 6</a></p>
<hr>
</section>
<section id="what-can-rubins-rules-be-used-on" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="what-can-rubins-rules-be-used-on"><span class="header-section-number">5.3</span> What can Rubin’s rules be used on?</h2>
<p>For inference (see above for CI and <span class="math inline">\(p\)</span>-value using t- and Fisher distribution) the assumption is that <span class="math inline">\(\overline{Q}\)</span> is approximately multivariate normal.</p>
<ul>
<li>Regression parameters in multiple linear regression</li>
<li>Regression parameters in logistic regression</li>
<li>Correlations: but use Fishers z-transform to become more normally distributed</li>
<li>ROC-AUC</li>
<li>Recently also predictions from the analysis model</li>
</ul>
</section>
</section>
<section id="imputation-model-in-multiple-imputation" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Imputation model in multiple imputation</h1>
<section id="sec-mlrimp" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sec-mlrimp"><span class="header-section-number">6.1</span> Multiple linear regression imputation model</h2>
<p>(<span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Chapter 3.2.1 and 3.2.2.)</p>
<p>Above, we looked at the two methods called “regression imputation” <a href="#sec-regrimp">Section&nbsp;3.6</a> and “stochastic regression imputation” <a href="#sec-stochregrimp">Section&nbsp;3.7</a>. We may add one more method, the “Bayesian (multiple) imputation linear regression”.</p>
<p>The setting here is that</p>
<ul>
<li>we are missing values in one covariate in the analysis model,</li>
<li>but have complete data for all other covariates and the response.</li>
<li>We now assume a multiple linear regression model with the covariate with missing values as the response,</li>
<li>and other covariates and the analysis model response as covariates in this imputation model</li>
</ul>
<p><a href="https://github.com/mettelang/MA8701V2023/blob/main/Part1/Imp3methLM.pdf">Note on these three methods</a>.</p>
<p>For the Bayesian part, <a href="https://en.wikipedia.org/wiki/Bayesian_linear_regression">the Wikipedia entry for Bayesian linear regression</a> is useful reading, and we will also look into this in Part 2 on ridge regression (L7).</p>
<hr>
<p><strong>Summary:</strong> if the imputation model is a multiple linear regression model, and all covariates in the model are known (only missing values in the covariate that we make our target response), we know how to draw new observations to impute the missing values - and we may construct many imputed data sets.</p>
<hr>
</section>
<section id="predictive-mean-matching" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="predictive-mean-matching"><span class="header-section-number">6.2</span> Predictive mean matching</h2>
<p>(<span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Chapter 3.4)</p>
<p>An hot deck method is a method where values are imputed based on existing values in the data set, by matching the missing observation with each of the observed observations (individuals).</p>
<p>Above (in the notes) we have considered the Bayesian linear regression and the “starting point” of the algorithm is that we have estimated the multiple linear regression coefficient <span class="math inline">\(\hat{\phi}\)</span> and drawn <span class="math inline">\(\dot \phi\)</span> from the posterior distribution.</p>
<hr>
<p>Algorithm 3.3 in <span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Section 3.4.2, copied from <a href="https://github.com/stefvanbuuren/fimdbook/blob/master/Rmd/04-multivariate-missing.Rmd">github Rmd file</a>:</p>
<ol type="1">
<li><p>Calculate <span class="math inline">\(\dot\phi\)</span> and <span class="math inline">\(\hat\phi\)</span> by Steps 1-8 of Algorithm 3.1.</p></li>
<li><p>Calculate <span class="math inline">\(\dot\eta(i,j)=|X_i^\mathrm{obs}\hat\phi-X_j^\mathrm{mis}\dot\phi|\)</span> with <span class="math inline">\(i=1,\dots,n_1\)</span> and <span class="math inline">\(j=1,\dots,n_0\)</span>.</p></li>
<li><p>Construct <span class="math inline">\(n_0\)</span> sets <span class="math inline">\(Z_j\)</span>, each containing <span class="math inline">\(d\)</span> candidate donors, from <span class="math inline">\(Y_\mathrm{obs}\)</span> such that <span class="math inline">\(\sum_d\dot\eta(i,j)\)</span> is minimum for all <span class="math inline">\(j=1,\dots,n_0\)</span>. Break ties randomly.</p></li>
<li><p>Draw one donor <span class="math inline">\(i_j\)</span> from <span class="math inline">\(Z_j\)</span> randomly for <span class="math inline">\(j=1,\dots,n_0\)</span>.</p></li>
<li><p>Calculate imputations <span class="math inline">\(\dot y_j = y_{i_j}\)</span> for <span class="math inline">\(j=1,\dots,n_0\)</span>.</p></li>
</ol>
<hr>
</section>
<section id="missing-patterns" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="missing-patterns"><span class="header-section-number">6.3</span> Missing patterns</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># code from https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">4</span><span class="sc">*</span><span class="dv">8</span><span class="sc">*</span><span class="dv">3</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),<span class="at">nrow=</span><span class="dv">8</span><span class="sc">*</span><span class="dv">4</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">dimnames=</span><span class="fu">list</span>(<span class="cn">NULL</span>,<span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>)))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>data[<span class="fu">c</span>(<span class="dv">31</span><span class="sc">:</span><span class="dv">32</span>),<span class="st">"A"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>data[<span class="fu">c</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">16</span>,<span class="dv">22</span><span class="sc">:</span><span class="dv">24</span>,<span class="dv">30</span><span class="sc">:</span><span class="dv">32</span>),<span class="st">"B"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>data[<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">12</span><span class="sc">:</span><span class="dv">16</span>,<span class="dv">17</span><span class="sc">:</span><span class="dv">21</span>,<span class="dv">27</span><span class="sc">:</span><span class="dv">29</span>),<span class="st">"C"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>mdpat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">expand.grid</span>(<span class="at">rec =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">pat =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">var =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">r=</span><span class="fu">as.numeric</span>(<span class="fu">as.vector</span>(<span class="fu">is.na</span>(data))))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>pattern1 <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>pattern2 <span class="ot">&lt;-</span> data[<span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>,]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>pattern3 <span class="ot">&lt;-</span> data[<span class="dv">17</span><span class="sc">:</span><span class="dv">24</span>,]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>pattern4 <span class="ot">&lt;-</span> data[<span class="dv">25</span><span class="sc">:</span><span class="dv">32</span>,]</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">#types &lt;-  c("Univariate","Monotone","File matching","General")</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>types <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"Univariate"</span>,<span class="st">"Monotone"</span>,<span class="st">"General"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>mdpat3<span class="ot">=</span>mdpat[mdpat<span class="sc">$</span>pat<span class="sc">!=</span><span class="dv">3</span>,]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="fu">levelplot</span>(r<span class="sc">~</span>var<span class="sc">+</span>rec<span class="sc">|</span><span class="fu">as.factor</span>(pat), <span class="at">data=</span>mdpat3,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">as.table=</span><span class="cn">TRUE</span>, <span class="at">aspect=</span><span class="st">"iso"</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">shrink=</span><span class="fu">c</span>(<span class="fl">0.9</span>),</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.regions =</span> <span class="fu">mdc</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">colorkey=</span><span class="cn">FALSE</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">scales=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">between =</span> <span class="fu">list</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">y=</span><span class="dv">0</span>),</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip =</span> <span class="fu">strip.custom</span>(<span class="at">bg =</span> <span class="st">"grey95"</span>, <span class="at">style =</span> <span class="dv">1</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">factor.levels =</span> types))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>For univariate missing pattern, we already have a solution above <a href="#sec-mlrimp">Section&nbsp;6.1</a>, and this solution can be made more flexible with other regression types.</p>
<p>For monotone patterns, see <span class="citation" data-cites="missinghandbook2014">Molenberghs et al. (<a href="#ref-missinghandbook2014" role="doc-biblioref">2014</a>)</span> Section 12.3.1 for regression-based imputation - which can be seen as using the univariate missing pattern solution in sequence.</p>
<hr>
</section>
<section id="joint-modelling" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="joint-modelling"><span class="header-section-number">6.4</span> Joint modelling</h2>
<p>Joint modelling handles general missing patterns, and assumes missing data are MAR.</p>
<p>A joint distribution for all variables are specified, often a multivariate normal distribution. Imputations are drawn from this model, and this can be done pr missing data pattern based on the conditional distribution for these patterns.</p>
<p>This method is popular with multilevel data (hierarchical model), and mixed types of variables (continuous, binary, categorical).</p>
<p>A popular solution is to model the observed data using Markov Chain Monte Carlo (MCMC) and treating the missing values as parameters and updating them in the MCMC algorithm.</p>
<p>See <span class="citation" data-cites="missinghandbook2014">Molenberghs et al. (<a href="#ref-missinghandbook2014" role="doc-biblioref">2014</a>)</span> Chapter 14.</p>
<hr>
</section>
<section id="fully-conditional-specification" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="fully-conditional-specification"><span class="header-section-number">6.5</span> Fully conditional specification</h2>
<p>(also called chained equations, sequantial regression multivariate imputation)</p>
<p><span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Sections 4.5.1 and 4.5.2 and <span class="citation" data-cites="missinghandbook2014">Molenberghs et al. (<a href="#ref-missinghandbook2014" role="doc-biblioref">2014</a>)</span> Chapter 13.</p>
<p>Also this type of solution is for general missing patterns, and when missing data are MAR.</p>
<hr>
<section id="notation-1" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="notation-1"><span class="header-section-number">6.5.1</span> Notation</h3>
<p>We here need (even one more) new notation.</p>
<p>Let all variables for the imputation models be denoted <span class="math inline">\(Y\)</span>. This then includes the response and covariates of the analysis model, and additional variables that is to be included in the imputation model. Assume the data are now put into a <span class="math inline">\(N \times p\)</span> matrix for <span class="math inline">\(N\)</span> observations (rows) and <span class="math inline">\(p\)</span> variables (columns).</p>
<ul>
<li><span class="math inline">\(Y_{j}\)</span>: is then the vector with the <span class="math inline">\(j\)</span>th variable to be modelled - this will be a response in the imputation model</li>
<li>and the elements of <span class="math inline">\(Y_{_j}\)</span> are either observed <span class="math inline">\(Y^{\mathrm{obs}}_{j}\)</span> or missing <span class="math inline">\(Y^{\mathrm{mis}}_{j}\)</span>.</li>
<li><span class="math inline">\(Y_{-j}\)</span>: is then a matrix with all variables except the <span class="math inline">\(j\)</span>th variable and are the covariates in an imputation model where <span class="math inline">\(Y_{j}\)</span> is the response.</li>
<li><span class="math inline">\(R\)</span> is the indicator matrix giving the missing pattern of <span class="math inline">\(Y\)</span>.</li>
<li><span class="math inline">\(\dot Y_j\)</span>: is a imputation of missing values in <span class="math inline">\(Y^{\mathrm{mis}}_{j}\)</span>.</li>
<li><span class="math inline">\(\phi_j\)</span>: are parameters in the imputation model where <span class="math inline">\(Y_{j}\)</span> is the response and <span class="math inline">\(Y_{-j}\)</span> are the covariates. This parameter is not related to the parameters of the analysis model.</li>
</ul>
<hr>
</section>
<section id="mice-algorithm" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="mice-algorithm"><span class="header-section-number">6.5.2</span> MICE algorithm</h3>
<p>The following algorithm is presented in <span class="citation" data-cites="missinghandbook2014">Molenberghs et al. (<a href="#ref-missinghandbook2014" role="doc-biblioref">2014</a>)</span> Figure 13.3 and <span class="citation" data-cites="VanBuuren2018">van Buuren (<a href="#ref-VanBuuren2018" role="doc-biblioref">2018</a>)</span> Algorithm 4.3 (Section 4.5.2), and copied from <a href="https://github.com/stefvanbuuren/fimdbook/blob/master/Rmd/04-multivariate-missing.Rmd">github Rmd file</a>.</p>
<ol type="1">
<li><p>Specify an imputation model <span class="math inline">\(P(Y_j^\mathrm{m}|Y_j^\mathrm{obs}, Y_{-j}, R)\)</span> for variable <span class="math inline">\(Y_j\)</span> with <span class="math inline">\(j=1,\dots,p\)</span>.</p></li>
<li><p>For each <span class="math inline">\(j\)</span>, fill in starting imputations <span class="math inline">\(\dot Y_j^0\)</span> by random draws from <span class="math inline">\(Y_j^\mathrm{obs}\)</span>.</p></li>
</ol>
<hr>
<ol start="3" type="1">
<li><p>Repeat for <span class="math inline">\(t = 1,\dots,M\)</span>.</p></li>
<li><p>Repeat for <span class="math inline">\(j = 1,\dots,p\)</span>.</p></li>
<li><p>Define <span class="math inline">\(\dot Y_{-j}^t = (\dot Y_1^t,\dots,\dot Y_{j-1}^t,\dot Y_{j+1}^{t-1},\dots,\dot Y_p^{t-1})\)</span> as the currently complete data except <span class="math inline">\(Y_j\)</span>.</p></li>
<li><p>Draw <span class="math inline">\(\dot\phi_j^t \sim P(\phi_j^t|Y_j^\mathrm{obs}, \dot Y_{-j}^t, R)\)</span>.</p></li>
<li><p>Draw imputations <span class="math inline">\(\dot Y_j^t \sim P(Y_j^\mathrm{mis}|Y_j^\mathrm{obs}, \dot Y_{-j}^t, R, \dot\phi_j^t)\)</span>.</p></li>
<li><p>End repeat <span class="math inline">\(j\)</span>.</p></li>
<li><p>End repeat <span class="math inline">\(t\)</span>.</p></li>
</ol>
<hr>
<p>The number of iterations <span class="math inline">\(t\)</span> is recommended to be 5 to 10. However, convergence of the algorithm can only be seen when it has been achieved, so more iterations may be needed.</p>
<p>Maybe this is not very clear from the algoritm, but this is a Markov Chain Monte Carlo method, and in particular it is a Gibbs sampler (if the conditional distribution together form a joint distribution). The algorithm must then be able to converge to a stationary distribution for us to use the results. Please refer to TMA4300 Computation statistics for detail on MCMC.</p>
<p>In the R mice package the <span class="math inline">\(m\)</span> multiple imputation data sets (streams) are run in parallell - that is the MICE algorithm listed above is run <span class="math inline">\(m\)</span> times simultaneously and convergence can be monitored for each and all streams together. In convergece plots then the <span class="math inline">\(m\)</span> streams are plotted together for each of the <span class="math inline">\(t\)</span> iterations.</p>
<hr>
<p>The algorithm can run into problems if the variables in the imputation model are highly correlated, when the missing rate is high and when there are constraints on the imputation model.</p>
<p>See slides pages 85+86 of <a href="https://amices.org/Winnipeg/Lectures/Winnipeg.pdf">MICE course</a> for difference between convergence and non-convergence of the MICE algorithm.</p>
<hr>
</section>
<section id="predictors-in-imputation-models" class="level3" data-number="6.5.3">
<h3 data-number="6.5.3" class="anchored" data-anchor-id="predictors-in-imputation-models"><span class="header-section-number">6.5.3</span> Predictors in imputation models</h3>
<ul>
<li>Include “all” variables to be used in the main analysis (the analysis model)</li>
<li>Better with too many predictors than too few (rich model is best)</li>
<li>Include the data analysis model response as covariate in the imputation models, see for example <span class="citation" data-cites="moonsetal2006">Moons KG (<a href="#ref-moonsetal2006" role="doc-biblioref">2006</a>)</span></li>
<li>Include variables that are predictors of missingness, or associated with the varible to be inputed (none of these may be part of the analysis model)</li>
<li>Limit the number of predictors for stability, and many MI methods does not handle correlated predictors very well</li>
<li>Nonlinear effects and interactions - should that be included? Note: passive imputation!</li>
</ul>
<hr>
</section>
</section>
<section id="r-examples" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="r-examples"><span class="header-section-number">6.6</span> R examples</h2>
<section id="nhanes-1" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="nhanes-1"><span class="header-section-number">6.6.1</span> NHANES</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">=</span> <span class="fu">mice</span>(nhanes, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(bmi <span class="sc">~</span> age))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of missing observations for our variables</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>imp<span class="sc">$</span>nmis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>age bmi hyp chl 
  0   9   8  10 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of mice results</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">pool</span>(fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         term  estimate std.error statistic       df      p.value
1 (Intercept) 29.621111  2.248428 13.174145 12.62920 9.477666e-09
2         age -1.802222  1.108781 -1.625408 14.42517 1.257173e-01</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace line plot, can be used to check convergence</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/mice%20plots-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density of observed and imputed data, observed in blue</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/mice%20plots-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One dimensional scatter plots for observed and imputed data, observed in blue</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stripplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/mice%20plots-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="airquality-1" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="airquality-1"><span class="header-section-number">6.6.2</span> Airquality</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(airquality, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">100</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>imp<span class="sc">$</span>predictorMatrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        Ozone Solar.R Wind Temp Month Day
Ozone       0       1    1    1     1   1
Solar.R     1       0    1    1     1   1
Wind        1       1    0    1     1   1
Temp        1       1    1    0     1   1
Month       1       1    1    1     0   1
Day         1       1    1    1     1   0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>imp<span class="sc">$</span>method <span class="co"># only two variables have missing data and these use PMM</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Ozone Solar.R    Wind    Temp   Month     Day 
  "pmm"   "pmm"      ""      ""      ""      "" </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(Wind<span class="sc">~</span>Temp<span class="sc">+</span>Month<span class="sc">+</span>Solar.R<span class="sc">+</span>Ozone))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 100 
         term   m     estimate         ubar            b            t dfcom
1 (Intercept) 100 15.904460339 5.543541e+00 3.212965e-01 5.868050e+00   148
2        Temp 100 -0.051514199 1.389312e-03 1.546204e-04 1.545479e-03   148
3       Month 100 -0.081483057 3.514546e-02 1.676292e-03 3.683851e-02   148
4     Solar.R 100  0.005374955 7.710940e-06 7.322321e-07 8.450495e-06   148
5       Ozone 100 -0.056164250 1.013722e-04 2.801934e-05 1.296717e-04   148
        df        riv     lambda        fmi
1 137.3781 0.05853830 0.05530107 0.06876042
2 129.5290 0.11240569 0.10104739 0.11461352
3 138.9150 0.04817279 0.04595883 0.05940408
4 131.8991 0.09590976 0.08751611 0.10104450
5 108.2238 0.27916473 0.21823986 0.23229729</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace line plot, can be used to check convergence</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density of observed and imputed data, observed in blue</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One dimensional scatter plots for observed and imputed data, observed in blue</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stripplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="pima-indians-1" class="level3" data-number="6.6.3">
<h3 data-number="6.6.3" class="anchored" data-anchor-id="pima-indians-1"><span class="header-section-number">6.6.3</span> Pima indians</h3>
<p>Default is that all available covariates are used as predictors for each missing variable. Here we do not have missing data in all variables, only skin, bp and bmi.</p>
<p>The methods for each imputation model are by default PMM for continuous and logistic regression for binary, and ordered logistic for categorical ordered. We only have continuous variables so all have PMM as default.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(Pima.tr2, <span class="at">print =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">seed =</span> <span class="dv">24415</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>imp<span class="sc">$</span>predictorMatrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      npreg glu bp skin bmi ped age type
npreg     0   1  1    1   1   1   1    1
glu       1   0  1    1   1   1   1    1
bp        1   1  0    1   1   1   1    1
skin      1   1  1    0   1   1   1    1
bmi       1   1  1    1   0   1   1    1
ped       1   1  1    1   1   0   1    1
age       1   1  1    1   1   1   0    1
type      1   1  1    1   1   1   1    0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>imp<span class="sc">$</span>method <span class="co"># only three variables have missing data and these use PMM</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>npreg   glu    bp  skin   bmi   ped   age  type 
   ""    "" "pmm" "pmm" "pmm"    ""    ""    "" </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">glm</span>(type <span class="sc">~</span> bmi<span class="sc">+</span>glu<span class="sc">+</span>bp<span class="sc">+</span>skin<span class="sc">+</span>ped<span class="sc">+</span>age<span class="sc">+</span>npreg,<span class="at">family =</span> <span class="st">"binomial"</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>est <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mipo    m = 10 
         term  m     estimate         ubar            b            t dfcom
1 (Intercept) 10 -9.017293217 1.768031e+00 8.562343e-02 1.862217e+00   292
2         bmi 10  0.090112079 1.032292e-03 3.242343e-04 1.388950e-03   292
3         glu 10  0.037186980 3.478594e-05 1.619869e-07 3.496413e-05   292
4          bp 10 -0.007477016 2.177787e-04 1.439980e-05 2.336185e-04   292
5        skin 10 -0.005760483 3.130320e-04 1.741249e-04 5.045694e-04   292
6         ped 10  1.278515220 2.844704e-01 3.514902e-04 2.848570e-01   292
7         age 10  0.011237457 2.508869e-04 1.141528e-05 2.634437e-04   292
8       npreg 10  0.124595592 2.756896e-03 5.337703e-06 2.762767e-03   292
         df         riv      lambda         fmi
1 255.36623 0.053271556 0.050577229 0.057926663
2  83.57231 0.345500862 0.256782342 0.273952211
3 288.30227 0.005122346 0.005096242 0.011926973
4 237.55172 0.072733352 0.067801893 0.075552393
5  46.36292 0.611877743 0.379605554 0.404741607
6 289.60952 0.001359155 0.001357310 0.008183080
7 258.19534 0.050049666 0.047664094 0.054956229
8 289.36196 0.002129741 0.002125215 0.008951512</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace line plot, can be used to check convergence</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density of observed and imputed data, observed in blue</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One dimensional scatter plots for observed and imputed data, observed in blue</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stripplot</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="W3_files/figure-html/unnamed-chunk-34-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="model-selection-and-assessment-when-using-multiple-imputation" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Model selection and assessment when using multiple imputation</h1>
<p>Will address this to some extent in Part 2 and 3. Here are some elements to consider.</p>
<ul>
<li>Model selection can be done in the statistical analysis in the MI-loop, and there is a count method combined with Wald test that can be used to make a consensus model from the potentially <span class="math inline">\(m\)</span> different MI-models. This is of cause dependent on that we have a parametric model as an analysis model. Done in case study presented in class (not in notes).</li>
<li>If the analysis model is not a parametric model, maybe a tree or neural net or ensemble, what do we then do with Rubin’s rules? It is possible to use them on the predictions or on the ROC-AUC. But, is that useful to do on a “training set”?</li>
</ul>
<hr>
<ul>
<li>For model assessment we may use a separate test set. This test set will have missing data, and the missing data model can be used to impute <span class="math inline">\(m\)</span> test sets. These test sets can then be run through the fitted final model (from the traning set) and Rubin’s rules can be used to give results on the test data. Note: role of analysis model response in test set imputed models.</li>
<li>Model assessement without a test set may be done using an outer bootstrap loop around the MI-loop. Then the .632+ boostrap estimator is preferred in <span class="citation" data-cites="BootMIWahl2016">Wahl et al. (<a href="#ref-BootMIWahl2016" role="doc-biblioref">2016</a>)</span>. For this publication a model selection step was not present - only model assessment.</li>
<li>Other methods than regression type may be used for imputation, and SuperMICE is using an ensemble machine larning (we will cover the autoML aka SuperLearner i Part 3). See <span class="citation" data-cites="supermice2021">Laqueur, Shev, and Kagawa (<a href="#ref-supermice2021" role="doc-biblioref">2021</a>)</span>.</li>
</ul>
<!-- # The mice R package -->
<!-- <https://github.com/amices/ggmice> -->
<!-- Plots for imputed data: -->
<!-- * one-dimensional scatter: stripplot  -->
<!-- * box-and-whisker plot: bwplot  -->
<!-- * densities: densityplot  -->
<!-- * scatterplot: xyplot -->
</section>
<section id="not-covered" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Not covered</h1>
<p>(this semester - will improve)</p>
<section id="ignorable-and-nonignorable" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="ignorable-and-nonignorable"><span class="header-section-number">8.1</span> Ignorable and nonignorable</h2>
<p>to which extent can we analyse the data without estimating the missingness paramterer <span class="math inline">\(\psi\)</span>? The parameter of interest in the analysis model is <span class="math inline">\(\theta\)</span>. When can we estimated <span class="math inline">\(\theta\)</span> without knowing <span class="math inline">\(\psi\)</span>? Little and Rubin: missing data mechanism is ignorable (for likelihood inference) if MAR and parameters <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\psi\)</span> distinct. More strict for Baysian inference, then priors for the two must be independent.</p>
<p>Further implications of nonignorability is that <span class="math inline">\(R\)</span> must be a part of the imputation model.</p>
</section>
</section>
<section id="exercises" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Exercises</h1>
<p>Missing… but this will be explored in the Data analysis project!</p>
<p>Maybe you want to look at the exercise from the van Buuren Winnipeg lectures:</p>
<p><a href="https://amices.org/Winnipeg/Practicals/Practical_I.html" class="uri">https://amices.org/Winnipeg/Practicals/Practical_I.html</a> <a href="https://amices.org/Winnipeg/Practicals/Practical_II.html" class="uri">https://amices.org/Winnipeg/Practicals/Practical_II.html</a> <a href="https://amices.org/Winnipeg/Practicals/Practical_III.html" class="uri">https://amices.org/Winnipeg/Practicals/Practical_III.html</a> <a href="https://amices.org/Winnipeg/Practicals/Practical_IV.html" class="uri">https://amices.org/Winnipeg/Practicals/Practical_IV.html</a></p>
<section id="links" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="links"><span class="header-section-number">9.1</span> Links</h2>
<ul>
<li><a href="https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html" class="uri">https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html</a></li>
<li><a href="https://github.com/stefvanbuuren/fimdbook" class="uri">https://github.com/stefvanbuuren/fimdbook</a></li>
<li>R-analysis from the FIMD book: <a href="https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R" class="uri">https://github.com/stefvanbuuren/fimdbook/blob/master/R/fimd.R</a></li>
<li>Slide set from Stef van Buuren (2017): <a href="https://amices.org/Winnipeg/Lectures/WinnipegHandout.pdf" class="uri">https://amices.org/Winnipeg/Lectures/WinnipegHandout.pdf</a> and <a href="https://amices.org/Winnipeg/" class="uri">https://amices.org/Winnipeg/</a></li>
<li><a href="https://amices.org/" class="uri">https://amices.org/</a></li>
</ul>
</section>
</section>
<section id="references" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-casi" class="csl-entry" role="doc-biblioentry">
Efron, Bradley, and Trevor Hastie. 2016. <em>Computer Age Statistical Inference - Algorithms, Evidence, and Data Science</em>. Cambridge University Press. <a href="https://hastie.su.domains/CASI/">https://hastie.su.domains/CASI/</a>.
</div>
<div id="ref-supermice2021" class="csl-entry" role="doc-biblioentry">
Laqueur, Hannah S, Aaron B Shev, and Rose M C Kagawa. 2021. <span>“<span class="nocase">SuperMICE: An Ensemble Machine Learning Approach to Multiple Imputation by Chained Equations</span>.”</span> <em>American Journal of Epidemiology</em> 191 (3): 516–25. <a href="https://doi.org/10.1093/aje/kwab271">https://doi.org/10.1093/aje/kwab271</a>.
</div>
<div id="ref-lydersen_multippel" class="csl-entry" role="doc-biblioentry">
Lydersen, Stian. 2022. <span>“Multippel Imputering Av Manglende Data.”</span> <em>Tidsskrift for Den Norske Legeforening</em>. <a href="https://doi.org/10.4045/tidsskr.21.0772">https://doi.org/10.4045/tidsskr.21.0772</a>.
</div>
<div id="ref-missinghandbook2014" class="csl-entry" role="doc-biblioentry">
Molenberghs, Geert, Garrett Fitzmaurice, Michael G. Kenward, Anastasios Tsiatis, and Geert Verbeke. 2014. <em>Handbook of <span>Missing</span> <span>Data</span> <span>Methodology</span></em>. Chapman &amp; <span>Hall</span>/<span>CRC</span> <span>Handbooks</span> of <span>Modern</span> <span>Statistical</span> <span>Methods</span>. Boca Raton: Chapman; Hall/CRC. <a href="https://search.ebscohost.com/login.aspx?direct=true&amp;db=nlebk&amp;AN=1499432&amp;site=ehost-live&amp;scope=site">https://search.ebscohost.com/login.aspx?direct=true&amp;db=nlebk&amp;AN=1499432&amp;site=ehost-live&amp;scope=site</a>.
</div>
<div id="ref-moonsetal2006" class="csl-entry" role="doc-biblioentry">
Moons KG, Stijnen T, Donders RA. 2006. <span>“Using the Outcome for Imputation of Missing Predictor Values Was Preferred.”</span> <em>J Clin Epidemiol.</em> 59(10): 1092–1101. <a href="https://doi.org/10.1016/j.jclinepi.2006.01.009">https://doi.org/10.1016/j.jclinepi.2006.01.009</a>.
</div>
<div id="ref-VanBuuren2018" class="csl-entry" role="doc-biblioentry">
van Buuren, Stef. 2018. <em>Flexible Imputation of Missing Data. Second Edition.</em> Boca Raton, FL.: CRC Press.
</div>
<div id="ref-BootMIWahl2016" class="csl-entry" role="doc-biblioentry">
Wahl, Simone, Anne-Laure Boulesteix, Astrid Zierer, Barbara Thorand, and Mark A. van de Wiel. 2016. <span>“Assessment of Predictive Performance in Incomplete Data by Combining Internal Validation and Multiple Imputation.”</span> <em>BMC Medical Research Methodology</em> 16 (1): 144. <a href="https://doi.org/10.1186/s12874-016-0239-7">https://doi.org/10.1186/s12874-016-0239-7</a>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>